<!Document>
<head>
    <link rel="stylesheet" type="text/css" href="/styles/imports.css">
    <link rel="stylesheet" type="text/css" href="/views/layout.css">
    <link rel="stylesheet" type="text/css" href="/views/nav.css">

    <link rel="stylesheet" type="text/css" href="/views/teacherView/teacherView.css">

    <title>Teacher</title>
    <link rel="icon" href="/assets/strix_logo.png">
</head>
<html>
<body>
    <!-- Header -->
    <div data-include="header"></div>

    <!-- Navigation -->
    <div data-include="navigation"></div>

    <!-- BG -->
    <div id="bg1"></div>
    <div id="particleGenerator"></div>

    <!-- Main -->
    <main>
        <div class="leftnav">
            <div class="block">
                <a href="about.html">
                    <img src="assets/strix_logo.png" />
                </a>
            </div>
            <div id="subnavchoices" class="choices">
                <div class="choice selected">
                    <button class="dropdown-btn">
                        <p>Players</p>
                        <i class="fa fa-caret-down"></i>
                    </button>
                    <div class="dropdown-container">

                        <button class="subbtn">
                            <p>Morgan</p>
                            <i class="fa fa-caret-down"></i>
                        </button>
                        <div class="sub dropdown-container">
                            <p class="subNavChoice">Profile</p>
                            <p class="subNavChoice">Details</p>
                            <p class="subNavChoice">Courses</p>
                            <p class="subNavChoice">Exams</p>
                            <p class="subNavChoice">Job and Extras</p>
                        </div>

                        <button class="subbtn">
                            <p>Sami</p>
                            <i class="fa fa-caret-down"></i>
                        </button>
                        <div class="sub dropdown-container">
                            <p class="subNavChoice">Profile</p>
                            <p class="subNavChoice">Details</p>
                            <p class="subNavChoice">Courses</p>
                            <p class="subNavChoice">Exams</p>
                            <p class="subNavChoice">Job and Extras</p>
                        </div>

                        <button class="subbtn">
                            <p>Timo</p>
                            <i class="fa fa-caret-down"></i>
                        </button>
                        <div class="sub dropdown-container">
                            <p class="subNavChoice">Profile</p>
                            <p class="subNavChoice">Details</p>
                            <p class="subNavChoice">Courses</p>
                            <p class="subNavChoice">Exams</p>
                            <p class="subNavChoice">Job and Extras</p>
                        </div>

                        <button class="subbtn">
                            <p>Martin</p>
                            <i class="fa fa-caret-down"></i>
                        </button>
                        <div class="sub dropdown-container">
                            <p class="subNavChoice">Profile</p>
                            <p class="subNavChoice">Details</p>
                            <p class="subNavChoice">Courses</p>
                            <p class="subNavChoice">Exams</p>
                            <p class="subNavChoice">Job and Extras</p>
                        </div>

                        <button class="subbtn">
                            <p>Will</p>
                            <i class="fa fa-caret-down"></i>
                        </button>
                        <div class="sub dropdown-container">
                            <p class="subNavChoice">Profile</p>
                            <p class="subNavChoice">Details</p>
                            <p class="subNavChoice">Courses</p>
                            <p class="subNavChoice">Exams</p>
                            <p class="subNavChoice">Job and Extras</p>
                        </div>

                    </div>
                </div>
                <div class="choice">
                    <p>Strixhaven Star</p>
                </div>
                <div class="choice">
                    <p>NPCs</p>
                </div>
                <div class="choice">
                    <p>Coming Soon</p>
                </div>
                <div class="choice">
                    <p>Logout</p>
                </div>
            </div>
        </div>
        <div id="pages" class="mainpage">
            <div class="page" id="players">
                <h2>Players</h2>
                <div class="mainbody">
                    <div class="view" id="profile">
                        <div class="top">
                            <div class="card">
                                <img id="profilepicture" />
                            </div>
                            <form id="profileform1">
                                <label>Name: <input id="name" placeholder="Name" disabled /></label>
                                <label>Age: <input id="age" placeholder="Age" disabled /></label>
                                <label>Gender: <input id="gender" placeholder="Gender" disabled /></label>
                                <label>Race: <input id="race" placeholder="Race" disabled /></label>
                                <label>Subrace: <input id="subrace" placeholder="Subrace" disabled /></label>
                                <label>Alignment: <input id="alignment" placeholder="Alignment" disabled /></label>
                                <label>Hair Colour: <input id="haircolour" placeholder="Hair Colour" disabled /></label>
                                <label>Eye Colour: <input id="eyecolour" placeholder="Eye Colour" disabled /></label>
                            </form>
                            <form id="profileform2">
                                <label>Height: <input id="height" placeholder="Height" disabled /></label>
                                <label>Weight: <input id="weight" placeholder="Weight" disabled /></label>
                                <label>Level: <input id="level" placeholder="Level" disabled /></label>
                                <label>Class: <input id="class" placeholder="Class" disabled /></label>
                                <label>Subclass: <input id="subclass" placeholder="Subclass" disabled /></label>
                                <label>Background: <input id="background" placeholder="Background" disabled /></label>
                            </form>
                        </div>
                        <div class="bottom">
                            <div class="personality scrollbar">
                                <div class="personal">
                                    <p>Personality Traits:</p>
                                    <textarea id="personalitytraits" class="scrollbar" placeholder="Personality Traits" readonly></textarea>
                                </div>
                                <div class="personal">
                                    <p>Ideals:</p>
                                    <textarea id="ideals" class="scrollbar" placeholder="Ideals" readonly></textarea>
                                </div>
                                <div class="personal">
                                    <p>Bonds:</p>
                                    <textarea id="bonds" class="scrollbar" placeholder="Bonds" readonly></textarea>
                                </div>
                                <div class="personal">
                                    <p>Flaws:</p>
                                    <textarea id="flaws" class="scrollbar" placeholder="Flaws" readonly></textarea>
                                </div>
                                <div class="personal">
                                    <p>Goals:</p>
                                    <textarea id="goals" class="scrollbar" placeholder="Your life time desire" readonly></textarea>
                                </div>
                            </div>
                            <div class="right">
                                <div class="formfield">
                                    <label>Background Features:</label>
                                    <textarea id="backgroundfeatures" class="scrollbar" placeholder="Background Features" readonly></textarea>
                                </div>
                                <div class="formfield">
                                    <label>Additional Character Appearance:</label>
                                    <textarea id="appearance" class="scrollbar" placeholder="Additional Character Appearance" readonly></textarea>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="view" id="details" hidden>
                        <div class="splitbody">
                            <div class="split">
                                <p>Backstory:</p>
                                <textarea id="backstory" class="scrollbar" placeholder="Backstory" readonly></textarea>
                            </div>
                            <div class="split">
                                <p>Extras:</p>
                                <textarea id="extranotes" class="scrollbar" placeholder="Extra notes" readonly></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="view" id="courses" hidden>courses</div>

                    <div class="view" id="exams" hidden>exams</div>

                    <div class="view" id="job and extras" hidden>job and extras</div>

                </div>
            </div>
            <div class="page" id="strixhaven star" hidden>
                <h2>Strixhaven Star</h2>
            </div>

            <div class="page" id="npcs" hidden>
                <h2>NPCs</h2>
            </div>

            <div class="page" id="coming soon" hidden>
                <h2>Coming Soon</h2>
            </div>
        </div>
    </main>
</body>
</html>

<script src="https://code.jquery.com/jquery-3.6.1.js"></script>
<script src="/javascript/nav.js"></script>
<script src="https://unpkg.com/@supabase/supabase-js"></script>
<script>
    var dropdowns = [];
    var dropdown = document.getElementsByClassName("dropdown-btn");
    var subdown = document.getElementsByClassName("subbtn");
    for (var i = 0; i < dropdown.length; i++) {
        dropdowns.push(dropdown[i]);
    }
    for (var i = 0; i < subdown.length; i++) {
        dropdowns.push(subdown[i]);
    }
    for (var i = 0; i < dropdowns.length; i++) {
        dropdowns[i].addEventListener("click", openSubElements);
    }
    function openSubElements() {
        var dropdownContent = this.nextElementSibling;
        var subDrops = this.parentNode.querySelectorAll('.subbtn');

        if (subDrops) {
            for (var x = 0; x < subDrops.length; x++) {
                if (subDrops[x].classList == 'subbtn active') {
                    if (subDrops[x] != this) {
                        subDrops[x].classList.toggle("active");
                        subDrops[x].nextElementSibling.style.display = "none";
                    }
                }
            }
        }

        this.classList.toggle("active");
        if (dropdownContent.style.display === "block") {
            dropdownContent.style.display = "none";
        } else {
            dropdownContent.style.display = "block";
        }
    }
</script>
<script>
    var pageid = 'Professor DM';
    $(function () {
        var includes = $('[data-include]')
        $.each(includes, function () {
            var file = 'views/addons/_' + $(this).data('include') + '.html'
            $(this).load(file)
        })
    })

    $('.choice').click(function () {
        var subnav = document.getElementById('subnavchoices');
        var choices = subnav.querySelectorAll('.choice');
        for (var x = 0; x < choices.length; x++) {
                choices[x].classList = "choice";
        }
        this.classList = "choice selected";

        var choice = this.querySelector('p');
        var toshow = choice.innerText.toLowerCase();

        if (toshow == "logout") {
            logot();
        }


        var mainpage = document.getElementById('pages');
        var pages = mainpage.querySelectorAll('.page');
        for (var x = 0; x < pages.length; x++) {
            if (pages[x]) {
                pages[x].setAttribute("hidden", "true");
            }
        }

        
        
        
        document.getElementById(toshow).toggleAttribute("hidden");
        
    })
    $('.control').click(function () {
        if (this.id == "edit") {
            if (this.classList != "fa fa-pencil-square-o activecontrol") {
                this.classList = "fa fa-pencil-square-o activecontrol";
                togglecurrent();
            } else {
                this.classList = "control fa fa-pencil-square-o";
                togglecurrent();
            }
        }
        if (this.id == "save") {
            var mainpage = document.getElementById('pages');
            var pages = mainpage.querySelectorAll('.page');
            for (var x = 0; x < pages.length; x++) {
                if (pages[x]) {
                    if (pages[x].id == "courses") {
                        var courses = [];
                        var year = this.parentNode.parentNode;
                        var selects = year.querySelectorAll('select');
                        for (var y = 0; y < selects.length; y++) {
                            var select = selects[y];
                            var options = select.querySelectorAll('option');
                            for (var z = 0; z < options.length; z++) {
                                var option = options[z];
                                if (option.selected) {
                                    if (option.value.includes(":")) {
                                        var selected = option.value;
                                        var split = selected.split(":");
                                        courses.push(split[0]);
                                    }
                                }
                            }
                        }
                        if (courses.length > 0) {
                            saveCourseChoices(courses);
                        }
                    } else {
                        if (window.getComputedStyle(pages[x]).display != "none") {
                            var editbtn = pages[x].querySelector('#edit');
                            if (editbtn.classList != "control fa fa-pencil-square-o") {
                                togglecurrent();
                                editbtn.classList = "control fa fa-pencil-square-o";
                            }
                            var inputs = pages[x].querySelectorAll('input');
                            var textareas = pages[x].querySelectorAll('textarea');
                            var allinputs = [];
                            for (var y = 0; y < inputs.length; y++) {
                                if (inputs[y].id) {
                                    allinputs.push(inputs[y]);
                                }
                            }
                            for (var y = 0; y < textareas.length; y++) {
                                if (textareas[y].id) {
                                    allinputs.push(textareas[y]);
                                }
                            }
                            saveStudentData(allinputs);
                        }
                    }
                }
            }
        }
    })
    function togglecurrent() {
        var mainpage = document.getElementById('pages');
        var pages = mainpage.querySelectorAll('.page');
        for (var x = 0; x < pages.length; x++) {
            if (pages[x]) {
                if (window.getComputedStyle(pages[x]).display != "none") {
                    var inputs = pages[x].querySelectorAll('input');
                    var textareas = pages[x].querySelectorAll('textarea');
                    for (var y = 0; y < inputs.length; y++) {
                        inputs[y].toggleAttribute("disabled");
                    }
                    for (var y = 0; y < textareas.length; y++) {
                        textareas[y].toggleAttribute("readonly");
                    }
                }
            }
        }
    }
    function toshow(id) {
        var send = 0;
        if (id == "one") {
            send = 0;
        }
        if (id == "two") {
            send = 1;
        }
        if (id == "three") {
            send = 2;
        }
        if (id == "four") {
            send = 3;
        }
        return send;
    }

    $('.subbtn').click(function () {
        var toget = this.innerText;
        getPlayerData(toget);
    })

    $('.subNavChoice').click(function () {
        var selectedView = this.innerText;
        var Views = document.getElementById('players').querySelector('.mainbody').querySelectorAll('.view');
        for (var x = 0; x < Views.length; x++) {
            Views[x].setAttribute("hidden", "true");
            if (Views[x].id == selectedView.toLowerCase()) {
                Views[x].toggleAttribute("hidden");
            }
        }
    })
</script>
<script src="../../API/api.js"></script>
<script src="/javascript/login.js"></script>
<script>
    $(document).ready(function () {
        getPP();
    })

    function getPlayerData(toget) {
        var page = document.getElementById('players');
        var header = page.querySelector('h2');
        var profile = page.querySelector('#profile');
        var details = page.querySelector('#details');

        for (var x = 0; x < PPCplayer.length; x++) {
            if (toget == PPCplayer[x]) {
                header.innerText = "Player: " + PPCplayer[x];
                profile.querySelector('#profilepicture').src = PPCimg[x];
                profile.querySelector('#name').value = PPCname[x];
                profile.querySelector('#age').value = PPCage[x];
                profile.querySelector('#gender').value = PPCgender[x];
                profile.querySelector('#race').value = PPCrace[x];
                profile.querySelector('#subrace').value = PPCsubrace[x];
                profile.querySelector('#alignment').value = PPCalignment[x];
                profile.querySelector('#haircolour').value = PPChaircolor[x];
                profile.querySelector('#eyecolour').value = PPCeyecolor[x];
                profile.querySelector('#height').value = PPCheight[x];
                profile.querySelector('#weight').value = PPCweight[x];
                profile.querySelector('#level').value = PPClevel[x];
                profile.querySelector('#class').value = PPCclasst[x];
                profile.querySelector('#subclass').value = PPCsubclass[x];
                profile.querySelector('#background').value = PPCbackground[x];

                profile.querySelector('#personalitytraits').value = PPCpersonalitytraits[x];
                profile.querySelector('#ideals').value = PPCideals[x];
                profile.querySelector('#bonds').value = PPCbonds[x];
                profile.querySelector('#flaws').value = PPCflaws[x];
                profile.querySelector('#goals').value = PPCgoals[x];

                profile.querySelector('#backgroundfeatures').value = PPCbackgroundfeatures[x];
                profile.querySelector('#appearance').value = PPCappearance[x];

                details.querySelector('#backstory').value = PPCbackstory[x];
                details.querySelector('#extranotes').value = PPCextranotes[x];
            }
        }
    }

    /* Player */
    var PPCid = [];
    var PPCplayer = [];
    var PPCimg = [];
    var PPCname = [];
    var PPCage = [];
    var PPCgender = [];
    var PPCrace = [];
    var PPCsubrace = [];
    var PPCalignment = [];
    var PPChaircolor = [];
    var PPCeyecolor = [];
    var PPCheight = [];
    var PPCweight = [];
    var PPClevel = [];
    var PPCclasst = [];
    var PPCsubclass = [];
    var PPCbackground = [];    
    var PPCpersonalitytraits = [];
    var PPCideals = [];
    var PPCbonds = [];
    var PPCflaws = [];
    var PPCgoals = [];
    var PPCbackgroundfeatures = [];
    var PPCappearance = [];    
    var PPCbackstory = [];
    var PPCextranotes = [];
    /* NPCs */
    var NPCid = [];
    var NPCimg = [];
    var NPCage = [];
    var NPCgender = [];
    var NPCname = [];
    var NPCrace = [];
    var NPCalignment = [];
    var NPChaircolor = [];
    var NPCeyecolor = [];
    var NPCweight = [];
    var NPCheight = [];



    function getPP() {
        _supabase.from('_tblStudents').select('*').order('id', { ascending: true }).then(response => {
            var data = response.data;
            for (var x = 0; x < data.length; x++) {
                var person = data[x];
                if (person['player']) {
                    // Players
                    PPCid.push(person['id']);
                    PPCplayer.push(person['player']);
                    PPCimg.push("assets/students/players/" + person['picture']);
                    PPCage.push(person['age']);
                    PPCgender.push(person['gender']);
                    PPCname.push(person['name']);
                    PPCrace.push(person['race']);
                    PPCalignment.push(person['alignment']);
                    PPChaircolor.push(person['haircolour']);
                    PPCeyecolor.push(person['eyecolour']);
                    PPCweight.push(person['weight']);
                    PPCheight.push(person['height']);
                    PPCappearance.push(person['appearance']);
                    PPCbackground.push(person['background']);
                    PPCbackgroundfeatures.push(person['backgroundfeatures']);
                    PPCbackstory.push(person['backstory']);
                    PPCbonds.push(person['bonds']);
                    PPCclasst.push(person['class']);
                    PPCextranotes.push(person['extranotes']);
                    PPCflaws.push(person['flaws']);
                    PPCgoals.push(person['goals']);
                    PPCideals.push(person['ideals']);
                    PPClevel.push(person['level']);
                    PPCpersonalitytraits.push(person['personalitytraits']);
                    PPCsubclass.push(person['subclass']);
                    PPCsubrace.push(person['subrace']);
                } else {
                    // NPCs
                    NPCid.push(person['id']);
                    NPCimg.push("assets/students/npcs/" + person['Profile Picture']);
                    NPCage.push(person['character_age']);
                    NPCgender.push(person['character_gender']);
                    NPCname.push(person['character_name']);
                    NPCrace.push(person['character_race']);
                    NPCalignment.push(person['Alignment']);
                    NPChaircolor.push(person['Hair Colour']);
                    NPCeyecolor.push(person['Eye Colour']);
                    NPCweight.push(person['Weight']);
                    NPCheight.push(person['Height']);
                }
            }
            // CREATE NPC LIST
            var page = document.getElementById('S3');
            for (var x = 0; x < NPCname.length; x++) {
                var newOption = document.createElement('option');

                newOption.value = x;
                newOption.innerText = NPCname[x];

                //  page.querySelector('#NPClist').appendChild(newOption);
            }
        })
    }

   
</script>