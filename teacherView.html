<!Document>
<head>
    <link rel="stylesheet" type="text/css" href="/styles/imports.css">
    <link rel="stylesheet" type="text/css" href="/views/layout.css">
    <link rel="stylesheet" type="text/css" href="/views/nav.css">

    <link rel="stylesheet" type="text/css" href="/views/teacherView/teacherView.css">

</head>
<html>
<body>
    <!-- Header -->
    <div data-include="header"></div>

    <!-- Logout -->
    <button class="logout" onclick="logout()">Logout</button>

    <!-- BG -->
    <div id="bg1"></div>
    <div id="particleGenerator"></div>

    <!-- Main -->
    <main>
        <div class="controls">
            <div id="one" class="control">
                <p>Players</p>
                <ul>
                    <li>
                        <div class="option">Morgan</div>
                    </li>
                    <li>
                        <div class="option">Sami</div>
                    </li>
                    <li>
                        <div class="option">Will</div>
                    </li>
                    <li>
                        <div class="option">Timo</div>
                    </li>
                    <li>
                        <div class="option">Martin</div>
                    </li>
                </ul>
            </div>
            <div id="two" class="control">
                <p>Strixhaven Star</p>
            </div>
            <div id="three" class="control">
                <p>NPCs</p>
            </div>
            <div id="four" class="control">
                <p>COMING SOON</p>
            </div>
        </div>
        <div id="mainslider" class="allContainer">
            <div id="S1" class="page">
                <div class="Playerprofile">
                    <div class="PPtop">
                        <div class="PPLeft">
                            <img id="PPimg"/>
                        </div>
                        <div class="PPRight"></div>
                    </div>
                    <div class="PPbot scrollbar">

                    </div>
                </div>
                <div class="PlayerprofileRight">

                </div>
            </div>
            <div id="S2" class="page">
                <div class="subnav">
                    <div id="SSPage1" class="sub">Page 1</div>
                    <div id="SSPage2" class="sub">Page 2</div>
                </div>
                <div class="SScontainer">
                    <div id="page1" class="pg1">page 1</div>
                    <div id="page2" class="pg2" style="display: none">page 2</div>
                </div>
                <div class="footerSpace">
                    <div class="baseSpacer"></div>
                    <div class="save" id="SSSave">Save</div>
                    <div class="baseSpacer"></div>
                </div>
            </div>
            <div id="S3" class="page">
                <h1>Page 1</h1>
            </div>
            <div id="S4" class="page">
                <img src="/assets/eliza.jpg" />
            </div>
        </div>

    </main>
</body>
</html>

<script src="https://code.jquery.com/jquery-3.6.1.js"></script>
<script src="../../javascript/teacherview.js"></script>
<script src="https://unpkg.com/@supabase/supabase-js"></script>
<script src="/API/api.js"></script>
<script>
    var pageid = 'Professor DM';
    $(function () {        
        var includes = $('[data-include]')
        $.each(includes, function () {
            var file = 'views/addons/_' + $(this).data('include') + '.html'
            $(this).load(file)
        })
        StrixhavenStar("get");  
        getPP();
    })

    var showing = 0;
    $('.control').click(function () {
        var MS = document.getElementById('mainslider');
        showing = toshow(this.id);
        var distance = "-" + $("#S1").width() * showing + "px";
        MS.style.transform = "translateX(" + distance + ")";
    });
    function toshow(id) {
        var send = 0;
        if (id == "one") {
            send = 0;
        }
        if (id == "two") {
            send = 1;
        }
        if (id == "three") {
            send = 2;
        }
        if (id == "four") {
            send = 3;
        }
        return send;
    }
    var ids = [".pg1", ".pg2", ".pg3"];
    var urls = ["views/news/_page1.html", "views/news/_page2.html", "views/news/_page3.html"];
    $.get(urls[0], function (data) {
        $(ids[0]).html(data);
        console.log("page 1 has been loaded");
    });
    $.get(urls[1], function (data) {
        $(ids[1]).html(data);
        console.log("page 2 has been loaded");
    });
    $.get(urls[2], function (data) {
        $(ids[2]).html(data);
        console.log("page 3 has been loaded");
    });
    $("#SSSave").click(function () {
        StrixhavenStar("save");
    })
    $(".sub").click(function () {
        if (this.id == "SSPage1") {
            document.getElementById("page1").style.display = "block";
            document.getElementById("page2").style.display = "none";
        }
        if (this.id == "SSPage2") {
            document.getElementById("page1").style.display = "none";
            document.getElementById("page2").style.display = "flex";
        }   
    })
    $('.option').click(function () {
        for (var x = 0; x < PPCplayer.length; x++) {
            if (PPCplayer[x] == this.innerText) {
                document.getElementById('PPimg').src = PPCimg[x];
            }
        }
    })
</script>
<script>
    function logout() {
        sessionStorage.clear();
        window.location = 'login.html';
    }

    const { createClient } = supabase;

    var anon = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBkY2Nhem1uemlwcGJsbnZ2cWRwIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTY2NzczNDkyOCwiZXhwIjoxOTgzMzEwOTI4fQ.79swd9Gvw45ziqMzXrIxPSnQU67K6swiVnSJAzujLqA';
    var url = 'https://pdccazmnzippblnvvqdp.supabase.co';
    const _supabase = createClient(url, anon);

    function StrixhavenStar(todo) {
        if (todo == "get") {
            _supabase.from('_tblStrixhavenStar').select('*').order('id', { ascending: true }).then(response => {
                var alldata = response.data;
                var runs = 0;
                for (var x = 0; x < alldata.length; x++) {
                    var data = alldata[x];

                    var page = data['pageNo'];
                    var location = data['location'];

                    var title = data['title'];
                    var content = data['content'];

                    // Get correct page
                    var togoPage = document.getElementById('page' + page);

                    if (page == 1) {
                        // Create Editable Boxs
                        const newMainTitle = document.createElement("input");
                        const newSection = document.createElement("div");
                        const newLeft = document.createElement("div");
                        const newLeftVid = document.createElement("video");
                        const newRight = document.createElement("div");
                        const newMainContent = document.createElement("textarea");

                        togoPage.querySelector('.Mainheadline').remove();

                        newMainTitle.classList = "Mainheadline";
                        newMainTitle.id = "newMainHeaderPage1";
                        newMainTitle.value = title;
                        togoPage.appendChild(newMainTitle);

                        togoPage.querySelector('.secContainer').remove();

                        newSection.classList = "secContainer";

                        newLeft.id = "pg1left";
                        newLeft.classList = "leftcol";

                        newLeftVid.src = "../assets/defSSvideo.mp4";
                        newLeftVid.type = "video/mp4";
                        newLeftVid.setAttribute("muted", true);
                        newLeftVid.setAttribute("autoplay", true);
                        newLeftVid.setAttribute("loop", true);

                        newLeft.appendChild(newLeftVid);

                        newSection.appendChild(newLeft);


                        newRight.id = "one";
                        newRight.classList = "right";


                        newMainContent.style.width = "200%";
                        newMainContent.style.height = "100%";
                        newMainContent.style.marginLeft = "15px";
                        newMainContent.value = content;
                        newMainContent.id = "newMainContentPage1";


                        newRight.appendChild(newMainContent);

                        newSection.appendChild(newRight);

                        togoPage.appendChild(newSection);



                        // check if sec con is out of view.
                        var contentContainer = togoPage.querySelector('.secContainer');
                        var bounding = contentContainer.getBoundingClientRect();
                        if (bounding.bottom > (window.innerHeight || document.documentElement.clientHeight)) {
                            //get height of title
                            var headerH = togoPage.querySelector('.Mainheadline').offsetHeight;
                            var currentH = contentContainer.offsetHeight;
                            contentContainer.style.height = currentH - headerH;
                        }
                    } else {
                        // Create Editable Boxs
                        const newleft = document.createElement("div");
                        const newMTop = document.createElement("div");
                        const newMBot = document.createElement("div");
                        const newright = document.createElement("div");

                        const newTitle = document.createElement("input");
                        const newCONTENT = document.createElement("textarea");

                        newTitle.value = title;
                        newCONTENT.value = content;

                        if (runs == 0) {
                            togoPage.querySelector("#pg2left").remove();
                            togoPage.querySelector("#pg2right").remove(); 
                            togoPage.querySelector("#pg2Mtop").remove();
                            togoPage.querySelector("#pg2Mbot").remove();
                            runs++;
                        }

                        if (location == "right") {
                            newright.id = "pg2right";
                            newright.classList = "right";
                            newTitle.id = 'newpg2rightTITLE';
                            newCONTENT.id = 'newpg2rightCONTENT';
                            newright.appendChild(newTitle);
                            newright.appendChild(newCONTENT);
                            togoPage.appendChild(newright);
                        }
                        if (location == "middle bottom") {
                            newright.id = "pg2Mbot";
                            newright.classList = "bot";
                            newTitle.id = 'newpg2MBTITLE';
                            newCONTENT.id = 'newpg2MBCONTENT';
                            newright.appendChild(newTitle);
                            newright.appendChild(newCONTENT);
                            togoPage.querySelector('.midwrapper').appendChild(newright);
                        }
                        if (location == "middle top") {
                            newright.id = "pg2Mtop";
                            newright.classList = "top";
                            newTitle.id = 'newpg2MTTITLE';
                            newCONTENT.id = 'newpg2MTCONTENT';
                            newright.appendChild(newTitle);
                            newright.appendChild(newCONTENT);
                            togoPage.querySelector('.midwrapper').appendChild(newright);
                        }
                        if (location == "left") {
                            newleft.id = "pg2left";
                            newleft.classList = "left";
                            newTitle.id = 'newpg2leftTITLE';
                            newCONTENT.id = 'newpg2leftCONTENT';
                            newleft.appendChild(newTitle);
                            newleft.appendChild(newCONTENT);
                            togoPage.insertBefore(newleft, togoPage.querySelector('.midwrapper'));
                        }                        
                    }
                }
            })
        }
        if (todo == "save") {
            // Page 1
            var newPG1Title = document.getElementById("newMainHeaderPage1").value;
            var newPG1Content = document.getElementById("newMainContentPage1").value;

            // Page 2
            var newPG2TitleL = document.getElementById("newpg2leftTITLE").value;
            var newPG2ContentL = document.getElementById("newpg2leftCONTENT").value;
            var newPG2TitleMT = document.getElementById("newpg2MTTITLE").value;
            var newPG2ContentMT = document.getElementById("newpg2MTCONTENT").value;
            var newPG2TitleMB = document.getElementById("newpg2MBTITLE").value;
            var newPG2ContentMB = document.getElementById("newpg2MBCONTENT").value;
            var newPG2TitleR = document.getElementById("newpg2rightTITLE").value;
            var newPG2ContentR = document.getElementById("newpg2rightCONTENT").value;

            _supabase.from('_tblStrixhavenStar').update({ title: newPG1Title, content: newPG1Content }).eq('location', 'one').then(response => {
            })
            _supabase.from('_tblStrixhavenStar').update({ title: newPG2TitleL, content: newPG2ContentL }).eq('location', 'left').then(response => {
            })
            _supabase.from('_tblStrixhavenStar').update({ title: newPG2TitleMT, content: newPG2ContentMT }).eq('location', 'middle top').then(response => {
            })
            _supabase.from('_tblStrixhavenStar').update({ title: newPG2TitleMB, content: newPG2ContentMB }).eq('location', 'middle bottom').then(response => {
            })
            _supabase.from('_tblStrixhavenStar').update({ title: newPG2TitleR, content: newPG2ContentR }).eq('location', 'right').then(response => {
            })

            alert("This should of saved have a check on Strixhaven Star or reload the page");
        }
    }

    var PPCplayer = [];
    var PPCname = [];
    var PPCrace = [];
    var PPCgender = [];
    var PPCage = [];
    var PPCimg = [];

    var NPCPname = [];
    var NPCPrace = [];
    var NPCPgender = [];
    var NPCPage = [];
    var NPCPimg = [];

    function getPP() {
        _supabase.from('_tblStudents').select('*').order('id', { ascending: true }).then(response => {
            var data = response.data;
            for (var x = 0; x < data.length; x++) {
                var person = data[x];
                if (person['character_player']) {
                    // Players
                    PPCplayer.push(person['character_player']);
                    PPCimg.push("assets/students/players/" + person['Profile Picture']);
                    PPCage.push(person['character_age']);
                    PPCgender.push(person['character_gender']);
                    PPCname.push(person['character_name']);
                    PPCrace.push(person['character_race']);
                } else {
                    // NPCs
                    NPCPimg.push(person['Profile Picture']);
                    NPCPage.push(person['character_age']);
                    NPCPgender.push(person['character_gender']);
                    NPCPname.push(person['character_name']);
                    NPCPrace.push(person['character_race']);
                }
            }
        })
    }
</script>