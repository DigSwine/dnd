<!Document>
<head>
    <link rel="stylesheet" type="text/css" href="/styles/imports.css">
    <link rel="stylesheet" type="text/css" href="/views/layout.css">
    <link rel="stylesheet" type="text/css" href="/views/nav.css">

    <link rel="stylesheet" type="text/css" href="/views/teacherView/teacherView.css">

    <title>Teacher</title>
    <link rel="icon" href="/assets/strix_logo.png">
</head>
<html>
<body>
    <!-- Header -->
    <div data-include="header"></div>

    <!-- Navigation -->
    <div data-include="navigation"></div>

    <!-- BG -->
    <div id="bg1"></div>
    <div id="particleGenerator"></div>

    <!-- Main -->
    <main>
        <div class="leftnav Vscrollbar">
            <div class="block">
                <a href="about.html">
                    <img src="assets/strix_logo.png" />
                </a>
            </div>
            <div id="subnavchoices" class="choices">
                <div class="choice">
                    <button class="dropdown-btn">
                        <p>Players</p>
                        <i class="fa fa-caret-down"></i>
                    </button>
                    <div class="dropdown-container">

                        <button class="subbtn">
                            <p>Morgan</p>
                            <i class="fa fa-caret-down"></i>
                        </button>
                        <div class="sub dropdown-container">
                            <p class="subNavChoice">Profile</p>
                            <p class="subNavChoice">Details</p>
                            <p class="subNavChoice">Courses</p>
                            <p class="subNavChoice">Exams</p>
                            <p class="subNavChoice">Job and Extras</p>
                            <p class="subNavChoice">Relationships</p>
                        </div>

                        <button class="subbtn">
                            <p>Sami</p>
                            <i class="fa fa-caret-down"></i>
                        </button>
                        <div class="sub dropdown-container">
                            <p class="subNavChoice">Profile</p>
                            <p class="subNavChoice">Details</p>
                            <p class="subNavChoice">Courses</p>
                            <p class="subNavChoice">Exams</p>
                            <p class="subNavChoice">Job and Extras</p>
                            <p class="subNavChoice">Relationships</p>
                        </div>

                        <button class="subbtn">
                            <p>Timo</p>
                            <i class="fa fa-caret-down"></i>
                        </button>
                        <div class="sub dropdown-container">
                            <p class="subNavChoice">Profile</p>
                            <p class="subNavChoice">Details</p>
                            <p class="subNavChoice">Courses</p>
                            <p class="subNavChoice">Exams</p>
                            <p class="subNavChoice">Job and Extras</p>
                            <p class="subNavChoice">Relationships</p>
                        </div>

                        <button class="subbtn">
                            <p>Martin</p>
                            <i class="fa fa-caret-down"></i>
                        </button>
                        <div class="sub dropdown-container">
                            <p class="subNavChoice">Profile</p>
                            <p class="subNavChoice">Details</p>
                            <p class="subNavChoice">Courses</p>
                            <p class="subNavChoice">Exams</p>
                            <p class="subNavChoice">Job and Extras</p>
                            <p class="subNavChoice">Relationships</p>
                        </div>

                        <button class="subbtn">
                            <p>Will</p>
                            <i class="fa fa-caret-down"></i>
                        </button>
                        <div class="sub dropdown-container">
                            <p class="subNavChoice">Profile</p>
                            <p class="subNavChoice">Details</p>
                            <p class="subNavChoice">Courses</p>
                            <p class="subNavChoice">Exams</p>
                            <p class="subNavChoice">Job and Extras</p>
                            <p class="subNavChoice">Relationships</p>
                        </div>

                    </div>
                </div>
                <div class="choice">
                    <p>Strixhaven Star</p>
                </div>
                <div class="choice">
                    <p>NPCs</p>
                </div>
                <div class="choice">
                    <p>Extra Notes</p>
                </div>
                <div class="choice">
                    <p>Coming Soon</p>
                </div>
                <div class=choice>
                    <p>Account</p>
                </div>
                <div class="choice">
                    <p>Logout</p>
                </div>
            </div>
        </div>
        <div id="pages" class="mainpage">
            <div class="page" id="players" hidden>
                <h2>Players</h2>
                <div class="mainbody">
                    <div class="view" id="profile">
                        <div class="top">
                            <div class="card">
                                <img id="profilepicture" />
                            </div>
                            <form id="profileform1">
                                <input id="pid" hidden />
                                <input id="player" hidden />
                                <label>Name: <input id="name" placeholder="Name" disabled /></label>
                                <label>Age: <input id="age" placeholder="Age" disabled /></label>
                                <label>Gender: <input id="gender" placeholder="Gender" disabled /></label>
                                <label>Race: <input id="race" placeholder="Race" disabled /></label>
                                <label>Subrace: <input id="subrace" placeholder="Subrace" disabled /></label>
                                <label>Alignment: <input id="alignment" placeholder="Alignment" disabled /></label>
                                <label>Hair Colour: <input id="haircolour" placeholder="Hair Colour" disabled /></label>
                                <label>Eye Colour: <input id="eyecolour" placeholder="Eye Colour" disabled /></label>
                            </form>
                            <form id="profileform2">
                                <label>Height: <input id="height" placeholder="Height" disabled /></label>
                                <label>Weight: <input id="weight" placeholder="Weight" disabled /></label>
                                <label>Level: <input id="level" placeholder="Level" disabled /></label>
                                <label>Class: <input id="class" placeholder="Class" disabled /></label>
                                <label>Subclass: <input id="subclass" placeholder="Subclass" disabled /></label>
                                <label>Background: <input id="background" placeholder="Background" disabled /></label>
                            </form>
                        </div>
                        <div class="bottom">
                            <div class="personality scrollbar">
                                <div class="personal">
                                    <p>Personality Traits:</p>
                                    <textarea id="personalitytraits" class="scrollbar" placeholder="Personality Traits" readonly></textarea>
                                </div>
                                <div class="personal">
                                    <p>Ideals:</p>
                                    <textarea id="ideals" class="scrollbar" placeholder="Ideals" readonly></textarea>
                                </div>
                                <div class="personal">
                                    <p>Bonds:</p>
                                    <textarea id="bonds" class="scrollbar" placeholder="Bonds" readonly></textarea>
                                </div>
                                <div class="personal">
                                    <p>Flaws:</p>
                                    <textarea id="flaws" class="scrollbar" placeholder="Flaws" readonly></textarea>
                                </div>
                                <div class="personal">
                                    <p>Goals:</p>
                                    <textarea id="goals" class="scrollbar" placeholder="Your life time desire" readonly></textarea>
                                </div>
                            </div>
                            <div class="right">
                                <div class="formfield">
                                    <label>Background Features:</label>
                                    <textarea id="backgroundfeatures" class="scrollbar" placeholder="Background Features" readonly></textarea>
                                </div>
                                <div class="formfield">
                                    <label>Additional Character Appearance:</label>
                                    <textarea id="appearance" class="scrollbar" placeholder="Additional Character Appearance" readonly></textarea>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="view" id="details" hidden>
                        <div class="splitbody">
                            <div class="split">
                                <p>Backstory:</p>
                                <textarea id="backstory" class="scrollbar" placeholder="Backstory" readonly></textarea>
                            </div>
                            <div class="split">
                                <p>Extras:</p>
                                <textarea id="extranotes" class="scrollbar" placeholder="Extra notes" readonly></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="view" id="courses" hidden>
                        <div class="top">
                            <div class="year">
                                <div class="controls">
                                    <button id="save" class="control fa fa-floppy-o"></button>
                                </div>
                                <h3>Year 1 courses</h3>
                                <div class="coursechoices">
                                    <div id="Y1S1" class="coursechoice">
                                        <select>
                                            <option>-- Select Course --</option>
                                        </select>
                                        <div class="classTeacher">
                                            <p></p>
                                        </div>
                                    </div>
                                    <div id="Y1S2" class="coursechoice">
                                        <select>
                                            <option>-- Select Course --</option>
                                        </select>
                                        <div class="classTeacher">
                                            <p></p>
                                        </div>
                                    </div>
                                    <div id="Y1S3" class="coursechoice">
                                        <select>
                                            <option>-- Select Course --</option>
                                        </select>
                                        <div class="classTeacher">
                                            <p></p>
                                        </div>
                                    </div>
                                    <div id="Y1S4" class="coursechoice">
                                        <select>
                                            <option>-- Select Course --</option>
                                        </select>
                                        <div class="classTeacher">
                                            <p></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="year">
                                <div class="controls">
                                    <button id="save" class="control fa fa-floppy-o"></button>
                                </div>
                                <h3>Year 2 courses</h3>
                                <div class="coursechoices">
                                    <div id="Y2S1" class="coursechoice">
                                        <select>
                                            <option>-- Select Course --</option>
                                        </select>
                                        <div class="classTeacher">
                                            <p></p>
                                        </div>
                                    </div>
                                    <div id="Y2S2" class="coursechoice">
                                        <select>
                                            <option>-- Select Course --</option>
                                        </select>
                                        <div class="classTeacher">
                                            <p></p>
                                        </div>
                                    </div>
                                    <div id="Y2S3" class="coursechoice">
                                        <select>
                                            <option>-- Select Course --</option>
                                        </select>
                                        <div class="classTeacher">
                                            <p></p>
                                        </div>
                                    </div>
                                    <div id="Y2S4" class="coursechoice">
                                        <select>
                                            <option>-- Select Course --</option>
                                        </select>
                                        <div class="classTeacher">
                                            <p></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="bottom">
                            <div class="year">
                                <div class="controls">
                                    <button id="save" class="control fa fa-floppy-o"></button>
                                </div>
                                <h3>Year 3 courses</h3>
                                <div class="coursechoices">
                                    <div id="Y3S1" class="coursechoice">
                                        <select>
                                            <option>-- Select Course --</option>
                                        </select>
                                        <div class="classTeacher">
                                            <p></p>
                                        </div>
                                    </div>
                                    <div id="Y3S2" class="coursechoice">
                                        <select>
                                            <option>-- Select Course --</option>
                                        </select>
                                        <div class="classTeacher">
                                            <p></p>
                                        </div>
                                    </div>
                                    <div id="Y3S3" class="coursechoice">
                                        <select>
                                            <option>-- Select Course --</option>
                                        </select>
                                        <div class="classTeacher">
                                            <p></p>
                                        </div>
                                    </div>
                                    <div id="Y3S4" class="coursechoice">
                                        <select>
                                            <option>-- Select Course --</option>
                                        </select>
                                        <div class="classTeacher">
                                            <p></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="year">
                                <div class="controls">
                                    <button id="save" class="control fa fa-floppy-o"></button>
                                </div>
                                <h3>Year 4 courses</h3>
                                <div class="coursechoices">
                                    <div id="Y4S1" class="coursechoice">
                                        <select>
                                            <option>-- Select Course --</option>
                                        </select>
                                        <div class="classTeacher">
                                            <p></p>
                                        </div>
                                    </div>
                                    <div id="Y4S2" class="coursechoice">
                                        <select>
                                            <option>-- Select Course --</option>
                                        </select>
                                        <div class="classTeacher">
                                            <p></p>
                                        </div>
                                    </div>
                                    <div id="Y4S3" class="coursechoice">
                                        <select>
                                            <option>-- Select Course --</option>
                                        </select>
                                        <div class="classTeacher">
                                            <p></p>
                                        </div>
                                    </div>
                                    <div id="Y4S4" class="coursechoice">
                                        <select>
                                            <option>-- Select Course --</option>
                                        </select>
                                        <div class="classTeacher">
                                            <p></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="view" id="exams" hidden>
                        <div class="controls">
                            <button id="save" class="control fa fa-floppy-o"></button>
                        </div>
                        <div class="top">
                            <div class="year">
                                <h3>Year 1 Results</h3>
                                <div class="exams">

                                </div>
                            </div>
                            <div class="year">
                                <h3>Year 2 Results</h3>
                                <div class="exams">

                                </div>
                            </div>
                        </div>
                        <div class="bottom">
                            <div class="year">
                                <h3>Year 3 Results</h3>
                                <div class="exams">

                                </div>
                            </div>
                            <div class="year">
                                <h3>Year 4 Results</h3>
                                <div class="exams">

                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="view" id="jobandextras" hidden>
                        <div id="jobs">
                        </div>
                        <h2>Extracurricular</h2>
                        <div id="clubs">
                        </div>
                    </div>

                    <div class="view" id="relationships" hidden>
                        <div class="controls">
                            <button id="add" class="control fa fa-plus"></button>
                            <button id="edit" class="control fa fa-pencil-square-o"></button>
                            <button id="save" class="control fa fa-floppy-o"></button>
                        </div>
                        <div class="cubeWrapper">
                            <div id="cubes">
                            </div>
                        </div>
                        <div class="model" id="addModel" hidden>
                            <h1>Add new relationship</h1>
                            <select id="addRelationNPCs">
                                <option>-- Please select a Student --</option>
                            </select>
                            <button id="confirmRelation">Add relationship</button>
                            <button id="cancleRelation">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="page ss" id="strixhaven star" hidden>
                <div class="controls">
                    <button id="edit" class="control fa fa-pencil-square-o"></button>
                    <button id="save" class="control fa fa-floppy-o"></button>
                </div>
                <h2>Strixhaven Star</h2>
                <div class="topcontainer">
                    <div class="issue">2098423</div>
                    <div class="slogan">the only paper around</div>
                    <div class="paperdate">Monday, 1st November, 2022</div>
                </div>
                <div class="bodycontainer">
                    <div id="leftc" class="LCorn" style="display: none" onclick="previouspg()"></div>
                    <div id="rightc" class="RCorn" style="display: block" onclick="nextpg()"></div>

                    <div id="page1" class="pg1" style="display: block">page 1</div>
                    <div id="page2" class="pg2" style="display: none">page 2</div>
                    <div id="page3" class="pg3" style="display: none">page 3</div>
                </div>
            </div>

            <div class="page" id="npcs" hidden>
                <h2>NPCs</h2>
                <div class="controls">
                    <button id="add" class="control fa fa-plus"></button>
                    <button id="edit" class="control fa fa-pencil-square-o"></button>
                    <button id="save" class="control fa fa-floppy-o"></button>
                    <button id="delete" class="control fa fa-trash"></button>
                </div>
                <div class="npcProfile">
                    <div class="student">
                        <form id="profileform1">
                            <h3>Students</h3>
                            <div class="npcSelector">
                                <select id="npcList2">
                                    <option value="0">-- Please Select a NPC --</option>
                                </select>
                            </div>
                            <input id="nid" hidden />
                            <label><p>Name:</p><input id="name" placeholder="Name" disabled /></label>
                            <label><p>Age:</p><input id="age" placeholder="Age" disabled /></label>
                            <label><p>Gender:</p><input id="gender" placeholder="Gender" disabled /></label>
                            <label><p>Race:</p><input id="race" placeholder="Race" disabled /></label>
                            <label><p>Subrace:</p><input id="subrace" placeholder="Subrace" disabled /></label>
                            <label><p>Alignment:</p><input id="alignment" placeholder="Alignment" disabled /></label>
                            <label><p>Hair Colour:</p><input id="haircolour" placeholder="Hair Colour" disabled /></label>
                            <label><p>Eye Colour:</p><input id="eyecolour" placeholder="Eye Colour" disabled /></label>
                            <label><p>Height:</p><input id="height" placeholder="Height" disabled /></label>
                            <label><p>Weight:</p><input id="weight" placeholder="Weight" disabled /></label>
                            <label><p>Year:</p><input id="year" placeholder="Year" disabled /></label>
                            <label><p>Boon:</p><input id="boon" placeholder="Boon" disabled /></label>
                            <label><p>Bane:</p><input id="bane" placeholder="Bane" disabled /></label>
                            <div class="note">
                                <p>Extra Notes:</p>
                                <textarea id="extranotes" class="scrollbar" placeholder="Extra Notes" readonly></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="teacher">
                        <form id="profileform2">
                            <h3>Teachers</h3>
                            <div class="npcSelector">
                                <select id="teacherList">
                                    <option value="0">-- Please Select a NPC --</option>
                                </select>
                            </div>
                            <input id="tid" hidden />
                            <label><p>Name:</p><input id="teacher_name" placeholder="Name" disabled /></label>
                            <label><p>Role:</p><input id="teacher_role" placeholder="Role" disabled /></label>
                            <label>
                                <p>School:</p><select id="schooldropdown" disabled>
                                    <option value="0">-- Teacher School --</option>
                                    <option value="lorehold">Lorehold</option>
                                    <option value="prismari">Prismari</option>
                                    <option value="silverquill">Silverquill</option>
                                    <option value="quandrix">Quandrix</option>
                                    <option value="witherbloom">Witherbloom</option>
                                </select>
                            </label>
                            <label><p>Type:</p><input id="teacher_type" placeholder="Type" disabled /></label>
                            <p></p>
                            <p></p>
                            <p></p>
                            <p></p>
                            <p></p>
                            <p></p>
                            <p></p>
                            <p></p>
                            <p></p>
                            <p></p>
                            <div class="note">
                                <p>Description:</p>
                                <textarea id="teacher_description" class="scrollbar" placeholder="Description" readonly></textarea>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <div class="page extranotes" id="extra notes" hidden>
                <div class="controls">
                    <button id="save" class="control fa fa-floppy-o"></button>
                </div>
                <h2>Notes</h2>
                <div class="top">
                    <div class="notearea">
                        <h3>Year 1 Note</h3>
                        <textarea id="note"></textarea>
                    </div>
                    <div class="notearea">
                        <h3>Year 2 Note</h3>
                        <textarea id="note"></textarea>
                    </div>
                </div>
                <div class="bottom">
                    <div class="notearea">
                        <h3>Year 3 Note</h3>
                        <textarea id="note"></textarea>
                    </div>
                    <div class="notearea">
                        <h3>Year 4 Note</h3>
                        <textarea id="note"></textarea>
                    </div>
                </div>
            </div>

            <div class="page" id="coming soon" hidden>
                <h2>Coming Soon</h2>
            </div>

            <div class="page" id="account" hidden>
                <h2>Account Details</h2>
                <button>Reset username and/or password</button>
                <div id="confirmation" class="model" hidden>
                    <form>
                        <h3>Confirm username and password</h3>
                        <input placeholder="Username" />
                        <input placeholder="Password" />
                        <button>Submitt</button>
                    </form>
                </div>
            </div>
        </div>
    </main>
</body>
</html>

<script src="https://code.jquery.com/jquery-3.6.1.js"></script>
<script src="/javascript/nav.js"></script>
<script src="https://unpkg.com/@supabase/supabase-js"></script>
<script>
    var dropdowns = [];
    var dropdown = document.getElementsByClassName("dropdown-btn");
    var subdown = document.getElementsByClassName("subbtn");
    for (var i = 0; i < dropdown.length; i++) {
        dropdowns.push(dropdown[i]);
    }
    for (var i = 0; i < subdown.length; i++) {
        dropdowns.push(subdown[i]);
    }
    for (var i = 0; i < dropdowns.length; i++) {
        dropdowns[i].addEventListener("click", openSubElements);
    }
    function openSubElements() {
        var dropdownContent = this.nextElementSibling;
        var subDrops = this.parentNode.querySelectorAll('.subbtn');

        if (subDrops) {
            for (var x = 0; x < subDrops.length; x++) {
                if (subDrops[x].classList == 'subbtn active') {
                    if (subDrops[x] != this) {
                        subDrops[x].classList.toggle("active");
                        subDrops[x].nextElementSibling.style.display = "none";
                    }
                }
            }
        }

        this.classList.toggle("active");
        if (dropdownContent.style.display === "block") {
            dropdownContent.style.display = "none";
        } else {
            dropdownContent.style.display = "block";
        }
    }
</script>
<script>
    var pageid = 'Professor DM';
    $(function () {
        var includes = $('[data-include]')
        $.each(includes, function () {
            var file = 'views/addons/_' + $(this).data('include') + '.html'
            $(this).load(file)
        })
    })

    $('.choice').click(function () {
        var subnav = document.getElementById('subnavchoices');
        var choices = subnav.querySelectorAll('.choice');
        for (var x = 0; x < choices.length; x++) {
                choices[x].classList = "choice";
        }
        this.classList = "choice selected";

        var choice = this.querySelector('p');
        var toshow = choice.innerText.toLowerCase();

        if (toshow == "logout") {
            logot();
        }

        var mainpage = document.getElementById('pages');
        var pages = mainpage.querySelectorAll('.page');
        for (var x = 0; x < pages.length; x++) {
            if (pages[x]) {
                pages[x].setAttribute("hidden", "true");
            }
        }
        
        document.getElementById(toshow).toggleAttribute("hidden");
    })
    $('.control').click(function () {
        var page = this.parentNode.parentNode;
        if (this.id == "edit") {
            if (this.classList != "fa fa-pencil-square-o activecontrol") {
                this.classList = "fa fa-pencil-square-o activecontrol";
                togglecurrent();
            } else {
                this.classList = "control fa fa-pencil-square-o";
                togglecurrent();
            }
        }
        if (this.id == "save") {
            var saveloc = this.parentElement.parentElement.id;
            var editbtn = page.querySelector('#edit');
            var addbtn = page.querySelector('#add');
            var active = "";
            var bothselected = "no";
            if (editbtn && addbtn) {
                if (addbtn.classList != "control fa fa-plus" && editbtn.classList != "control fa fa-pencil-square-o") {
                    bothselected = "yes";
                }
            }
            if (bothselected == "no") {
                if (editbtn) {
                    if (editbtn.classList != "control fa fa-pencil-square-o") {
                        togglecurrent();
                        editbtn.classList = "control fa fa-pencil-square-o";
                        active = "edit";
                    }
                }
                if (addbtn) {
                    if (addbtn.classList != "control fa fa-plus") {
                        togglecurrent();
                        addbtn.classList = "control fa fa-plus";
                        active = "add";
                    }
                }

                if (saveloc == "courses") {

                } else if (saveloc == "relationships") {
                    var cubeList = page.querySelector('#cubes');
                    var cubes = cubeList.querySelectorAll('.cube');
                    if (active == "edit") {
                        for (var x = 0; x < cubes.length; x++) {
                            saveRelationship(cubes[x]);
                        }
                    }
                    if (active == "add") {
                        togglecurrent();
                        var page = this.parentElement.parentElement;
                        page.querySelector('#addModel').toggleAttribute('hidden');
                        console.log('hit');
                    }
                } else if (saveloc == "exams") {
                    var exams = [];
                    var results = [];
                    var selects = page.querySelectorAll('select');
                    for (var y = 0; y < selects.length; y++) {
                        var select = selects[y];
                        var options = select.querySelectorAll('option');
                        for (var z = 0; z < options.length; z++) {
                            var option = options[z];
                            if (option.selected) {
                                if (option.value != 0) {
                                    var sec = select.parentElement.id.split('exam');
                                    exams.push(sec[1]);
                                    results.push(option.value);
                                }
                            }
                        }
                    }
                    saveExamScores(exams, results);
                } else if (saveloc == "npcs") {
                    var allinputs = [];
                    var SorT = "";
                    if (this.parentElement.parentElement.querySelector('#nid').value) {
                        page = page.querySelector('.student');
                        SorT = "s";
                    }
                    if (this.parentElement.parentElement.querySelector('#tid').value) {
                        page = page.querySelector('.teacher');
                        SorT = "t";
                    }

                    var inputs = page.querySelectorAll('input');
                    var textareas = page.querySelectorAll('textarea');
                    var selects = page.querySelectorAll('select');


                    for (var y = 0; y < inputs.length; y++) {
                        if (inputs[y].id) {
                            allinputs.push(inputs[y]);
                        }
                    }
                    for (var y = 0; y < textareas.length; y++) {
                        if (textareas[y].id) {
                            allinputs.push(textareas[y]);
                        }
                    }
                    for (var y = 0; y < selects.length; y++) {
                        if (selects[y].id) {
                            allinputs.push(selects[y]);
                        }
                    }

                    if (SorT == "s") {
                        if (active == "edit") {
                            saveStudentData(allinputs);
                        }
                        if (active == "add") {
                            createNewStudentData(allinputs);
                        }
                    }
                    if (SorT == "t") {
                        if (active == "edit") {
                            saveTeacherData(allinputs);
                        }
                        if (active == "add") {
                            alert("new teachers require an image. Send me the info for the teacher");
                            // createNewStudentData(allinputs);
                        }
                    }
                } else if (saveloc == "extra notes") {
                    var textareas = page.querySelectorAll('textarea');
                    var allinputs = [];
                    for (var y = 0; y < textareas.length; y++) {
                        if (textareas[y].id) {
                            allinputs.push(textareas[y]);
                        }
                    }
                    saveNotes(allinputs);
                } else if (saveloc == "strixhaven star") {
                    var pages = ['#page1', '#pg2left', '#pg2Mtop', '#pg2Mbot', '#pg2right'];
                    var pgHeader = [];
                    var pgContent = [];
                    for (var x = 0; x < pages.length; x++) {
                        var pg = page.querySelector(pages[x]);
                        pgHeader.push(pg.querySelector('input'));
                        pgContent.push(pg.querySelector('textarea'));
                    }
                    saveSS(pages, pgHeader, pgContent);

                    var jobs = page.querySelector('.pg3').querySelector('.jobs').querySelectorAll('.job');
                    saveJobs(jobs);
                }
            } else {
                alert("Please make a choice if you want to edit or add");
            }
        }
        if (this.id == "add") {
            var addloc = this.parentElement.parentElement.id;
            if (this.classList != "fa fa-plus activecontrol") {
                this.classList = "fa fa-plus activecontrol";
            } else {
                this.classList = "control fa fa-plus";
            }

            if (addloc == "npcs") {
                var allinputs = [];
                var SorT = "";
                if (this.parentElement.parentElement.querySelector('#nid').value) {
                    page = page.querySelector('.student');
                    SorT = "s";
                }
                if (this.parentElement.parentElement.querySelector('#tid').value) {
                    page = page.querySelector('.teacher');
                    SorT = "t";
                }

                var inputs = page.querySelectorAll('input');
                var textareas = page.querySelectorAll('textarea');
                var selects = page.querySelectorAll('select');

                for (var y = 0; y < inputs.length; y++) {
                    if (inputs[y].id) {
                        allinputs.push(inputs[y]);
                    }
                }
                for (var y = 0; y < textareas.length; y++) {
                    if (textareas[y].id) {
                        allinputs.push(textareas[y]);
                    }
                }
                for (var y = 0; y < selects.length; y++) {
                    if (selects[y].id) {
                        allinputs.push(selects[y]);
                    }
                }

                if (SorT == "s") {
                    createNewStudentData(allinputs);
                }
                if (SorT == "t") {
                    // createNewStudentData(allinputs);
                }
                togglecurrent();
            }
            if (addloc == "relationships") {
                var page = this.parentElement.parentElement;
                page.querySelector('#addModel').toggleAttribute('hidden');
            }
        }
        if (this.id == "delete") {
            var editbtn = page.querySelector('#edit');
            var addbtn = page.querySelector('#add');
            var active = "";

            var nid = this.parentElement.parentElement.querySelector('#nid').value;
            if (nid) {
                SorT = "s";
            }

            if (SorT == "s") {
                deleteStudent(nid);
            }
        }
    })
    function togglecurrent() {
        var mainpage = document.getElementById('pages');
        var pages = mainpage.querySelectorAll('.page');
        for (var x = 0; x < pages.length; x++) {
            if (pages[x]) {
                if (window.getComputedStyle(pages[x]).display != "none") {
                    var inputs = pages[x].querySelectorAll('input');
                    var textareas = pages[x].querySelectorAll('textarea');
                    var selects = pages[x].querySelectorAll('select');
                    for (var y = 0; y < inputs.length; y++) {
                        inputs[y].toggleAttribute("disabled");
                    }
                    for (var y = 0; y < textareas.length; y++) {
                        textareas[y].toggleAttribute("readonly");
                    }
                    for (var y = 0; y < selects.length; y++) {
                        selects[y].toggleAttribute("disabled");
                    }
                }
            }
        }
    }
    function toshow(id) {
        var send = 0;
        if (id == "one") {
            send = 0;
        }
        if (id == "two") {
            send = 1;
        }
        if (id == "three") {
            send = 2;
        }
        if (id == "four") {
            send = 3;
        }
        return send;
    }

    $('.subbtn').click(function () {
        var toget = this.innerText;
        cleanPages();
        getPlayerData(toget);
    })

    $('#npcList').change(function () {
        getNPCRelationshipDataByID(this.value);

    })
    $('#npcList2').change(function () {
        cleanNPC('teacher');
        getNPCStudentDataByID(this.value);
    })
    $('#teacherList').change(function () {
        cleanNPC('student');
        getNPCTeacherDataByID(this.value);
    })

    $('#confirmRelation').click(function () {
        alert("working on it"); 
    })
    $('#cancleRelation').click(function () {
        var page = this.parentElement.parentElement;
        page.querySelector('#addModel').toggleAttribute('hidden');
        var addloc = page.querySelector('.controls').querySelector('#add');
        addloc.classList = "fa fa-plus";
    })

    function cleanPages(){
        var profile = document.getElementById('profile');
        var detail = document.getElementById('details');
        var courses = document.getElementById('courses');
        var exams = document.getElementById('exams');
        var job = document.getElementById('jobs');
        var club = document.getElementById('clubs');

        var courseYear = courses.querySelectorAll('.year');
        for (var x = 0; x < courseYear.length; x++) {
            var selectors = courseYear[x].querySelectorAll("select");
            var text = courseYear[x].querySelectorAll("p");
            var manditory = ['Y1S1', 'Y2S1', 'Y3S1', 'Y4S1'];
            for (var z = 0; z < manditory.length; z++) {
                for (var y = 0; y < selectors.length; y++) {
                    if (selectors[y].parentElement.id != manditory[z]) {
                        selectors[y].value = '0';
                        selectors[y].disabled = false;
                        text[y].innerHTML = "";
                    }
                }
            }
        }

        var courseExams = exams.querySelectorAll('.exams');
        for (var x = 0; x < courseExams.length; x++) {
            courseExams[x].innerHTML = " ";
        }

        job.innerHTML = "";
        club.innerHTML = "";
    }
    function cleanNPC(toclean) {
        var mainpage = document.getElementById('pages');
        var NPCpage = mainpage.querySelector('#npcs');
        var NPCstudent = NPCpage.querySelector('.student');
        var NPCteacher = NPCpage.querySelector('.teacher');

        if (toclean == "teacher") {
            var inputs = NPCteacher.querySelectorAll("input");
            var selects = NPCteacher.querySelectorAll("select");
            var textareas = NPCteacher.querySelectorAll("textarea");
        } 
        if (toclean == "student") {
            var inputs = NPCstudent.querySelectorAll("input");
            var selects = NPCstudent.querySelectorAll("select");
            var textareas = NPCstudent.querySelectorAll("textarea");
        } 
        for (var x = 0; x < inputs.length; x++) {
            inputs[x].value = "";
        }
        for (var x = 0; x < selects.length; x++) {
            selects[x].value = "0";
        }
        for (var x = 0; x < textareas.length; x++) {
            textareas[x].value = "";
        }
    }

    $('.subNavChoice').click(function () {
        var selectedView = this.innerText.toLowerCase();
        if (selectedView == "job and extras") {
            selectedView = 'jobandextras';
        }
        var Views = document.getElementById('players').querySelector('.mainbody').querySelectorAll('.view');
        var page = document.getElementById('players');
        var profile = page.querySelector('#profile');
        for (var x = 0; x < Views.length; x++) {
            Views[x].setAttribute("hidden", "true");
            if (Views[x].id == selectedView) {
                if (selectedView == "Job and Extras") {
                    page.querySelector('h2').innerText = "Job";
                } else {
                    var p = "Player: " + profile.querySelector('#player').value;
                    page.querySelector('h2').innerHTML = p;
                }
                Views[x].toggleAttribute("hidden");
            }
        }
    })

    var showing = 0;
    var pages = ["page1", "page2", "page3"];
    function toggleshow(el) {
        var element = document.getElementById(el);
        element.style.display = "none";
    }
    function nextpg() {
        if (showing < 2) {
            for (var x = 0; x < pages.length; x++) {
                toggleshow(pages[x]);
            }
            showing++;
            var toshow = document.getElementById(pages[showing]);
            var preBtn = document.getElementById('leftc');
            var nexBtn = document.getElementById('rightc');
            if (showing == 2) {
                toshow.style.display = "flex";
                nexBtn.style.display = "none";
            }
            preBtn.style.display = "block";
            toshow.style.display = "flex";
        }
    }
    function previouspg() {
        if (showing > 0) {
            for (var x = 0; x < pages.length; x++) {
                toggleshow(pages[x]);
            }
            showing--;
            var toshow = document.getElementById(pages[showing]);
            var preBtn = document.getElementById('leftc');
            var nexBtn = document.getElementById('rightc');
            if (showing == 0) {
                toshow.style.display = "block";
                preBtn.style.display = "none";
            } else {
                toshow.style.display = "flex";
                nexBtn.style.display = "block";
            }
        }
    }

    var ids = [".pg1", ".pg2", ".pg3"];
    var urls = ["views/news/_page1.html", "views/news/_page2.html", "views/news/_page3.html"];
    $.get(urls[0], function (data) {
        $(ids[0]).html(data);
    });
    $.get(urls[1], function (data) {
        $(ids[1]).html(data);
    });
    $.get(urls[2], function (data) {
        $(ids[2]).html(data);
    });
</script>
<script src="../../API/api.js"></script>
<script src="/javascript/login.js"></script>
<script>
    $(document).ready(function () {
        getPP();
        getCourseData();
        getNotes();
        getpapercontent();
    })

    /* Player */
    var PPCid = [];
    var PPCplayer = [];
    var PPCimg = [];
    var PPCname = [];
    var PPCage = [];
    var PPCgender = [];
    var PPCrace = [];
    var PPCsubrace = [];
    var PPCalignment = [];
    var PPChaircolor = [];
    var PPCeyecolor = [];
    var PPCheight = [];
    var PPCweight = [];
    var PPClevel = [];
    var PPCclasst = [];
    var PPCsubclass = [];
    var PPCbackground = [];    
    var PPCpersonalitytraits = [];
    var PPCideals = [];
    var PPCbonds = [];
    var PPCflaws = [];
    var PPCgoals = [];
    var PPCbackgroundfeatures = [];
    var PPCappearance = [];    
    var PPCbackstory = [];
    var PPCextranotes = [];
    var PPCyear = [];
    var PPCcollege = [];
    /* NPC students */
    var NPCid = [];
    var NPCplayer = [];
    var NPCimg = [];
    var NPCage = [];
    var NPCgender = [];
    var NPCname = [];
    var NPCrace = [];
    var NPCalignment = [];
    var NPChaircolor = [];
    var NPCeyecolor = [];
    var NPCweight = [];
    var NPCheight = [];
    var NPCappearance = [];
    var NPCbackground = [];
    var NPCbackgroundfeatures = [];
    var NPCbackstory = [];
    var NPCbonds = [];
    var NPCclasst = [];
    var NPCextranotes = [];
    var NPCflaws = [];
    var NPCgoals = [];
    var NPCideals = [];
    var NPClevel = [];
    var NPCpersonalitytraits = [];
    var NPCsubclass = [];
    var NPCsubrace = [];
    var NPCyear = [];
    var NPCcollege = [];
    var NPCextranotes = [];
    var NPCboon = [];
    var NPCbane = [];
    var NPCrScore = [];
    /* NPC teachers */
    var TPCid = [];
    var TPCname = [];
    var TPCrole = [];
    var TPCschool = [];
    var TPCtype = [];
    var TPCdescription = [];

    // Getters
    function getPP() {
        _supabase.from('_tblStudents').select('*').order('id', { ascending: true }).then(response => {
            var data = response.data;
            for (var x = 0; x < data.length; x++) {
                var person = data[x];
                if (person['player']) {
                    // Players
                    PPCid.push(person['id']);
                    PPCplayer.push(person['player']);
                    PPCimg.push("assets/students/players/" + person['picture']);
                    PPCage.push(person['age']);
                    PPCgender.push(person['gender']);
                    PPCname.push(person['name']);
                    PPCrace.push(person['race']);
                    PPCalignment.push(person['alignment']);
                    PPChaircolor.push(person['haircolour']);
                    PPCeyecolor.push(person['eyecolour']);
                    PPCweight.push(person['weight']);
                    PPCheight.push(person['height']);
                    PPCappearance.push(person['appearance']);
                    PPCbackground.push(person['background']);
                    PPCbackgroundfeatures.push(person['backgroundfeatures']);
                    PPCbackstory.push(person['backstory']);
                    PPCbonds.push(person['bonds']);
                    PPCclasst.push(person['class']);
                    PPCextranotes.push(person['extranotes']);
                    PPCflaws.push(person['flaws']);
                    PPCgoals.push(person['goals']);
                    PPCideals.push(person['ideals']);
                    PPClevel.push(person['level']);
                    PPCpersonalitytraits.push(person['personalitytraits']);
                    PPCsubclass.push(person['subclass']);
                    PPCsubrace.push(person['subrace']);
                    PPCyear.push(person['year']);
                    PPCcollege.push(person['college']);
                } else {
                    // NPCs
                    NPCid.push(person['id']);
                    NPCplayer.push(person['player']);
                    NPCimg.push("assets/students/players/" + person['picture']);
                    NPCage.push(person['age']);
                    NPCgender.push(person['gender']);
                    NPCname.push(person['name']);
                    NPCrace.push(person['race']);
                    NPCalignment.push(person['alignment']);
                    NPChaircolor.push(person['haircolour']);
                    NPCeyecolor.push(person['eyecolour']);
                    NPCweight.push(person['weight']);
                    NPCheight.push(person['height']);
                    NPCappearance.push(person['appearance']);
                    NPCbackground.push(person['background']);
                    NPCbackgroundfeatures.push(person['backgroundfeatures']);
                    NPCbackstory.push(person['backstory']);
                    NPCbonds.push(person['bonds']);
                    NPCclasst.push(person['class']);
                    NPCextranotes.push(person['extranotes']);
                    NPCflaws.push(person['flaws']);
                    NPCgoals.push(person['goals']);
                    NPCideals.push(person['ideals']);
                    NPClevel.push(person['level']);
                    NPCpersonalitytraits.push(person['personalitytraits']);
                    NPCsubclass.push(person['subclass']);
                    NPCsubrace.push(person['subrace']);
                    NPCyear.push(person['year']);
                    NPCcollege.push(person['college']);
                    NPCextranotes.push(person['extranotes']);
                    NPCboon.push(person['boon']);
                    NPCbane.push(person['bane']);
                }
            }
            // CREATE NPC LISTs
            var npcPage = document.getElementById('npcs');
            var relationPage = document.getElementById('relationships');
            for (var x = 0; x < NPCname.length; x++) {
                var newOption = document.createElement('option');

                newOption.value = NPCid[x];
                newOption.innerText = NPCname[x];

                npcPage.querySelector('#npcList2').appendChild(newOption);
            }
            for (var x = 0; x < NPCname.length; x++) {
                var newOption = document.createElement('option');

                newOption.value = NPCid[x];
                newOption.innerText = NPCname[x];

                relationPage.querySelector('#addRelationNPCs').appendChild(newOption);
            }
        })
        _supabase.from('_tblTeachers').select('*').order('id', { ascending: true }).then(response => {
            for (var x = 0; x < response.data.length; x++) {
                var person = response.data[x];
                if (person['id']) {
                    TPCid.push(person['id']);
                    TPCname.push(person['teacher_name']);
                    TPCrole.push(person['teacher_role']);
                    TPCschool.push(person['teacher_school']);
                    TPCtype.push(person['teacher_type']);
                    TPCdescription.push(person['teacher_description']);
                }
            }
            // CREATE NPC teacher list
            var npcPage = document.getElementById('npcs');
            for (var x = 0; x < TPCname.length; x++) {
                var newOption = document.createElement('option');

                newOption.value = TPCid[x];
                newOption.innerText = TPCname[x];

                npcPage.querySelector('#teacherList').appendChild(newOption);
            }
        });
    }
    function getPlayerData(toget) {
        var page = document.getElementById('players');
        var header = page.querySelector('h2');
        var profile = page.querySelector('#profile');
        var details = page.querySelector('#details');

        for (var x = 0; x < PPCplayer.length; x++) {
            if (toget == PPCplayer[x]) {
                header.innerText = "Player: " + PPCplayer[x];
                profile.querySelector('#pid').value = PPCid[x];
                profile.querySelector('#player').value = PPCplayer[x];
                profile.querySelector('#profilepicture').src = PPCimg[x];
                profile.querySelector('#name').value = PPCname[x];
                profile.querySelector('#age').value = PPCage[x];
                profile.querySelector('#gender').value = PPCgender[x];
                profile.querySelector('#race').value = PPCrace[x];
                profile.querySelector('#subrace').value = PPCsubrace[x];
                profile.querySelector('#alignment').value = PPCalignment[x];
                profile.querySelector('#haircolour').value = PPChaircolor[x];
                profile.querySelector('#eyecolour').value = PPCeyecolor[x];
                profile.querySelector('#height').value = PPCheight[x];
                profile.querySelector('#weight').value = PPCweight[x];
                profile.querySelector('#level').value = PPClevel[x];
                profile.querySelector('#class').value = PPCclasst[x];
                profile.querySelector('#subclass').value = PPCsubclass[x];
                profile.querySelector('#background').value = PPCbackground[x];

                profile.querySelector('#personalitytraits').value = PPCpersonalitytraits[x];
                profile.querySelector('#ideals').value = PPCideals[x];
                profile.querySelector('#bonds').value = PPCbonds[x];
                profile.querySelector('#flaws').value = PPCflaws[x];
                profile.querySelector('#goals').value = PPCgoals[x];

                profile.querySelector('#backgroundfeatures').value = PPCbackgroundfeatures[x];
                profile.querySelector('#appearance').value = PPCappearance[x];

                details.querySelector('#backstory').value = PPCbackstory[x];
                details.querySelector('#extranotes').value = PPCextranotes[x];

                getStudentDataByID(PPCid[x]);
            }
        }
    }   
    function getStudentDataByID(sid) {
        _supabase.from('Job<>Student').select('Job (id, Title, Location, Pay)').eq('Student', sid).then(response => {
            if (response.data.length > 0) {
                for (var x = 0; x < response.data.length; x++) {
                    var data = response.data[x];
                    var job = data['Job'];

                    var currentJob = document.getElementById('jobs');

                    const theJob = document.createElement('div');
                    const theTitle = document.createElement('p');
                    const theLocation = document.createElement('p');
                    const theWage = document.createElement('p');
                    const theCoworker = document.createElement('p');
                    const QuitButton = document.createElement('button');

                    theJob.classList = "job";
                    theJob.id = "job";
                    QuitButton.classList = "quit";
                    QuitButton.id = sid;
                    QuitButton.innerText = "Fire";
                    QuitButton.addEventListener('click', fireFromJob, false);

                    theTitle.innerText = job['Title'];
                    theTitle.classList = "title";

                    theLocation.innerText = job['Location'];
                    theLocation.classList = "location";

                    theWage.innerText = job['Pay'];
                    theWage.classList = "wage";

                    _supabase.from('Job<>Student').select('Student (id, name, player)').eq('Job', job['id']).then(response => {
                        var allworkers = response.data;
                        var wcount = 0;
                        var coworkers = "";
                        if (allworkers) {
                            for (var y = 0; y < allworkers.length; y++) {
                                var worker = allworkers[y]['Student'];
                                if (document.getElementById('profile').querySelector('#profileform1').querySelector('#pid').value != worker['id']) {
                                    if (wcount > 0) {
                                        coworkers = coworkers + " & " + worker['name'];
                                    } else {
                                        coworkers = worker['name'];
                                    }
                                    wcount++;
                                }
                            }
                        }
                        theCoworker.innerText = coworkers;
                        theCoworker.classList = "coworker";

                        theJob.appendChild(theTitle);
                        theJob.appendChild(theLocation);
                        theJob.appendChild(theCoworker);
                        theJob.appendChild(theWage);
                        theJob.appendChild(QuitButton);

                        currentJob.appendChild(theJob);
                    })
                }
            }
        })
        _supabase.from('Club<>Student').select('club (*)').eq('student', sid).then(response => {
            if (response.data.length > 0) {
                var clubs = document.getElementById('clubs');
                for (var x = 0; x < response.data.length; x++) {
                    var data = response.data[x];
                    var club = data['club'];

                    var clubid = club['id'];
                    var clubname = club['name'];
                    var clubskills = club['skills'];

                    const theClub = document.createElement('div');
                    const theClubName = document.createElement('p');
                    const theClubSkill = document.createElement('p');
                    const theClubDice = document.createElement('p');
                    const theClubMembers = document.createElement('div');

                    const theClubQuit = document.createElement('button');

                    theClub.classList = "club";

                    theClubName.classList = "clubname";
                    theClubName.innerText = clubname;

                    theClubSkill.classList = "clubskill";
                    theClubSkill.innerText = clubskills;

                    theClubDice.classList = "dice";
                    theClubDice.innerText = "1d4";

                    theClubMembers.classList = "members scrollbar";

                    _supabase.from('Club<>Student').select('student (id, name)').eq('club', clubid).then(response => {
                        for (var y = 0; y < response.data.length; y++) {
                            if (sid != response.data[y]['student']['id']) {
                                const theClubMember = document.createElement('p');
                                theClubMember.classList = "member";
                                theClubMember.innerText = response.data[y]['student']['name'];
                                theClubMembers.appendChild(theClubMember);
                            }
                        }
                    })

                    theClubQuit.classList = "quit";
                    theClubQuit.innerText = "Quit Club";
                    theClubQuit.id = clubid;
                   theClubQuit.addEventListener('click', kickFromClub, false);

                    theClub.appendChild(theClubName);
                    theClub.appendChild(theClubSkill);
                    theClub.appendChild(theClubDice);
                    theClub.appendChild(theClubMembers);

                    theClub.appendChild(theClubQuit);

                    clubs.appendChild(theClub);
                }
            }
        })
        _supabase.from('class<>student').select('class(id, year, name, required), student(id, name)').eq('student', sid).then(response => {
            var data = response.data;
            var Y1C = 1;
            var Y2C = 1;
            var Y3C = 1;
            var Y4C = 1;

            for (var x = 0; x < data.length; x++) {
                var course = data[x]['class'];
                var student = data[x]['student'];

                if (course['year'] == 1) {
                    var classChoice = "Y1S" + Y1C;
                    Y1C++;
                }
                if (course['year'] == 2) {
                    var classChoice = "Y2S" + Y2C;
                    Y2C++;
                }
                if (course['year'] == 3) {
                    var classChoice = "Y3S" + Y3C;
                    Y3C++;
                }
                if (course['year'] == 4) {
                    var classChoice = "Y4S" + Y4C;
                    Y4C++;
                }
                $('#' + classChoice + ' select > option').each(function () {
                    var split = $(this).val().split(":");
                    var courseId = split[0];
                    var teacher = split[1];

                    if (courseId == course['id']) {
                        $('#' + classChoice + ' select').val(course['id'] + ":" + teacher).change();
                        $('#' + classChoice + ' select').attr("disabled", "true");
                        $('#' + classChoice + ' p').text("Teacher: " + teacher);
                    }
                });
            }
        });
        _supabase.from('exam<>student').select('exam(*), score, studied, cheated').eq('student', sid).order('exam', { ascending: true }).then(response => {
            var examsPage = document.getElementById('exams');
            var examExams = examsPage.querySelectorAll('.exams');
            var exams = response.data;
            for (var x = 0; x < exams.length; x++) {
                var results = exams[x];

                var newExam = document.createElement("div");
                var newTitle = document.createElement("p");
                var newDropDown = document.createElement("select");
                var newDice = document.createElement("p");
                var newSkills = document.createElement("p");

                var options = ['-- Ungraded --', 'Pass', 'Fail', 'Ace'];
                var values = ['null', 'pass', 'fail', 'ace'];
                for (var z = 0; z < options.length; z++) {
                    var newDropOption = document.createElement("option");
                    newDropOption.innerText = options[z];
                    newDropOption.value = values[z];

                    newDropDown.appendChild(newDropOption);
                }

                var score = 0;
                if (results['score']) {
                    if (results['score'] == "pass") {
                        score = 1;
                    }
                    if (results['score'] == "ace") {
                        score = 2;
                    }
                }

                newTitle.innerText = results['exam']['name'];
                newDice.innerText = score + "d4";
                newSkills.innerText = results['exam']['skill'];

                newExam.id = "exam" + results['exam']['id'];

                newExam.appendChild(newTitle);
                newExam.appendChild(newDropDown);
                newExam.appendChild(newDice);
                newExam.appendChild(newSkills);

                examExams[results['exam']['year'] - 1].appendChild(newExam);

                var t = document.getElementById("exam" + results['exam']['id']);
                if (results['score']) {
                    t.querySelector('select').value = results['score'];
                }
            }
        });
        _supabase.from('npc<>student').select('npc(id, name, year, bane, boon), student, relationship').eq('student', sid).order('npc', { ascending: true }).then(response => {
            var relationshipPage = document.getElementById('relationships');
            var addSelected = relationshipPage.querySelector('select');
            
            var page = relationshipPage.querySelector('#cubes');
            page.innerHTML = "";
            for (var x = 0; x < response.data.length; x++) {
                var data = response.data[x];
                const newCube = document.createElement("div");
                const newName = document.createElement("p");

                const newScore = document.createElement("div");
                const newRelationship = document.createElement("div");
                const newBoon = document.createElement("div");
                const newBane = document.createElement("div");

                const newScoreSpan = document.createElement("span");
                const newRelationshipSpan = document.createElement("span");
                const newBoonSpan = document.createElement("span");
                const newBaneSpan = document.createElement("span");

                newName.innerText = data['npc']['name'];

                newScoreSpan.innerText = "Relationship Score: ";
                newScoreSpan.classList = "scoreTitle";
                newScore.appendChild(newScoreSpan);
                const newInput = document.createElement("input");
                newInput.value = data['relationship'];
                newInput.disabled = "true";
                newScore.appendChild(newInput);

                var text = "";
                if (data['relationship'] >= "-100") {
                    if (data['relationship'] >= 8) {
                        text = "Lover";
                    } else if (data['relationship'] >= "3") {
                        text = "Friend";
                    } else if (data['relationship'] >= "0") {
                        text = "Netural";
                    } else {
                        text = "Rival";
                    }
                }
                newRelationshipSpan.innerText = "Relationship: ";
                newRelationship.appendChild(newRelationshipSpan);
                var newTextRelationship = document.createElement('p');
                newTextRelationship.innerText = " " + text;
                newRelationship.appendChild(newTextRelationship);

                newBoonSpan.innerText = "Boon: ";
                newBoon.appendChild(newBoonSpan);
                var newTextBoon = document.createElement('p');
                newTextBoon.innerText = " " + data['npc']['boon'];
                newBoon.appendChild(newTextBoon);

                newBaneSpan.innerText = "Bane: ";
                newBane.appendChild(newBaneSpan);
                var newTextBane = document.createElement('p');
                newTextBane.innerText = " " + data['npc']['bane'];
                newBane.appendChild(newTextBane);

                newCube.classList = "cube";
                newCube.id = data['npc']['id'];

                newName.classList = "cName";

                newCube.appendChild(newName);
                newCube.appendChild(newScore);
                newCube.appendChild(newRelationship);
                newCube.appendChild(newBoon);
                newCube.appendChild(newBane);

                page.appendChild(newCube);

                var options = addSelected.querySelectorAll("option");
                for (var y = 0; y < options.length; y++) {
                    if (options[y].value == data['npc']['id']) {
                        options[y].setAttribute('hidden', 'true');
                    }
                }
            }
        });
    }
    function getCourseData() {
        _supabase.from('class<>teacher').select('class(id, name, year, required), teacher(id, teacher_name)').then(response => {
            var data = response.data;
            for (var x = 0; x < data.length; x++) {
                var course = data[x]['class'];
                var teacher = data[x]['teacher'];
                if (course['year'] == 1) {
                    $('#Y1S1 select').append($('<option>', {
                        value: course['id'] + ":" + teacher['teacher_name'],
                        text: course['name']
                    }))
                    $('#Y1S2 select').append($('<option>', {
                        value: course['id'] + ":" + teacher['teacher_name'],
                        text: course['name']
                    }))
                    $('#Y1S3 select').append($('<option>', {
                        value: course['id'] + ":" + teacher['teacher_name'],
                        text: course['name']
                    }))
                    $('#Y1S4 select').append($('<option>', {
                        value: course['id'] + ":" + teacher['teacher_name'],
                        text: course['name']
                    }))
                    if (course['required'] == "yes") {
                        $('#Y1S1 select').val(course['id'] + ":" + teacher['teacher_name']);
                        $('#Y1S1 select').attr("disabled", "true");
                        $('#Y1S1 p').text("Teacher: " + teacher['teacher_name']);
                    }
                }
                if (course['year'] == 2) {
                    $('#Y2S1 select').append($('<option>', {
                        value: course['id'] + ":" + teacher['teacher_name'],
                        text: course['name']
                    }))
                    $('#Y2S2 select').append($('<option>', {
                        value: course['id'] + ":" + teacher['teacher_name'],
                        text: course['name']
                    }))
                    $('#Y2S3 select').append($('<option>', {
                        value: course['id'] + ":" + teacher['teacher_name'],
                        text: course['name']
                    }))
                    $('#Y2S4 select').append($('<option>', {
                        value: course['id'] + ":" + teacher['teacher_name'],
                        text: course['name']
                    }))
                    if (course['required'] == "yes") {
                        $('#Y2S1 select').val(course['id'] + ":" + teacher['teacher_name']);
                        $('#Y2S1 select').attr("disabled", "true");
                        $('#Y2S1 p').text("Teacher: " + teacher['teacher_name']);
                    }
                }
                if (course['year'] == 3) {
                    $('#Y3S1 select').append($('<option>', {
                        value: course['id'] + ":" + teacher['teacher_name'],
                        text: course['name']
                    }))
                    $('#Y3S2 select').append($('<option>', {
                        value: course['id'] + ":" + teacher['teacher_name'],
                        text: course['name']
                    }))
                    $('#Y3S3 select').append($('<option>', {
                        value: course['id'] + ":" + teacher['teacher_name'],
                        text: course['name']
                    }))
                    $('#Y3S4 select').append($('<option>', {
                        value: course['id'] + ":" + teacher['teacher_name'],
                        text: course['name']
                    }))
                    if (course['required'] == "yes") {
                        $('#Y3S1 select').val(course['id'] + ":" + teacher['teacher_name']);
                        $('#Y3S1 select').attr("disabled", "true");
                        $('#Y3S1 p').text("Teacher: " + teacher['teacher_name']);
                    }
                }
                if (course['year'] == 4) {
                    $('#Y4S1 select').append($('<option>', {
                        value: course['id'] + ":" + teacher['teacher_name'],
                        text: course['name']
                    }))
                    $('#Y4S2 select').append($('<option>', {
                        value: course['id'] + ":" + teacher['teacher_name'],
                        text: course['name']
                    }))
                    $('#Y4S3 select').append($('<option>', {
                        value: course['id'] + ":" + teacher['teacher_name'],
                        text: course['name']
                    }))
                    $('#Y4S4 select').append($('<option>', {
                        value: course['id'] + ":" + teacher['teacher_name'],
                        text: course['name']
                    }))
                    if (course['required'] == "yes") {
                        $('#Y4S1 select').val(course['id'] + ":" + teacher['teacher_name']);
                        $('#Y4S1 select').attr("disabled", "true");
                        $('#Y4S1 p').text("Teacher: " + teacher['teacher_name']);
                    }
                }
            }
        });
    }

    function getNPCRelationshipDataByID(nid) {
        var page = document.getElementById('relationships');
        var npcInfo = page.querySelector('.NPCinfo');
        var npcRelationshipDetails = page.querySelector('.relationshipInputs');

        for (var x = 0; x < NPCid.length; x++) {
            if (NPCid[x] == nid) {
                npcInfo.querySelector('#npcid').value = nid;
                npcInfo.querySelector('#npcyr').value = NPCyear[x];
                var players = document.getElementById('players');
                var profile = players.querySelector('#profile');
                var sid = profile.querySelector('#pid').value;


                _supabase.from('npc<>student').select('npc(boon, bane), relationship').eq('npc', nid).eq('student', sid).then(response => {
                    var data = response.data;
                    for (var y = 0; y < data.length; y++) {
                        var value = response.data[y]['relationship'];

                        npcRelationshipDetails.querySelector('#rscore').value = value;
                        npcRelationshipDetails.querySelector('#rboon').value = response.data[y]['boon'];
                        npcRelationshipDetails.querySelector('#rbane').value = response.data[y]['bane'];
                        
                        if (value <= -2) {
                            npcRelationshipDetails.querySelector('#rrelationship').value = "rival";
                        } else {
                            if (value >= "-1") {
                                if (value >= 8) {
                                    npcRelationshipDetails.querySelector('#rrelationship').value = "Lover";
                                } else if (value >= "3") {
                                    npcRelationshipDetails.querySelector('#rrelationship').value = "Friend";
                                } else {
                                    npcRelationshipDetails.querySelector('#rrelationship').value = "Netural";
                                }
                            }
                        }

                    }
                });               
            }
        }
    }

    function getNPCStudentDataByID(nid) {
        for (var x = 0; x < NPCid.length; x++) {
            if (NPCid[x] == nid) {
                var page = document.getElementById('npcs');
                var NPCprofile = page.querySelector('.student');
                NPCprofile.querySelector('#nid').value = NPCid[x];
                NPCprofile.querySelector('#name').value = NPCname[x];
                NPCprofile.querySelector('#age').value = NPCage[x];
                NPCprofile.querySelector('#gender').value = NPCgender[x];
                NPCprofile.querySelector('#race').value = NPCrace[x];
                NPCprofile.querySelector('#subrace').value = NPCsubrace[x];
                NPCprofile.querySelector('#alignment').value = NPCalignment[x];
                NPCprofile.querySelector('#haircolour').value = NPChaircolor[x];
                NPCprofile.querySelector('#eyecolour').value = NPCeyecolor[x];
                NPCprofile.querySelector('#height').value = NPCheight[x];
                NPCprofile.querySelector('#weight').value = NPCweight[x];
                NPCprofile.querySelector('#year').value = NPCyear[x];
                NPCprofile.querySelector('#boon').value = NPCboon[x];
                NPCprofile.querySelector('#bane').value = NPCbane[x];
                NPCprofile.querySelector('#extranotes').value = NPCextranotes[x]
            }
        }
    }
    function getNPCTeacherDataByID(tid) {
        for (var x = 0; x < TPCid.length; x++) {
            if (TPCid[x] == tid) {
                var page = document.getElementById('npcs');
                var TPCprofile = page.querySelector('.teacher');
                TPCprofile.querySelector('#tid').value = TPCid[x];
                TPCprofile.querySelector('#teacher_name').value = TPCname[x];
                TPCprofile.querySelector('#teacher_role').value = TPCrole[x];
                TPCprofile.querySelector('#schooldropdown').value = TPCschool[x];
                TPCprofile.querySelector('#teacher_type').value = TPCtype[x];
                TPCprofile.querySelector('#teacher_description').value = TPCdescription[x];
            }
        }
    }
    function getNotes() {
        _supabase.from('notes').select('*').order('id', { ascending: true }).then(response => {
            var page = document.getElementById('extra notes');
            var notes = page.querySelectorAll('textarea');
            for (var x = 0; x < response.data.length; x++) {
                var note = response.data[x];
                if (note['year'] == 1) {
                    notes[0].value = note['note'];
                }
                if (note['year'] == 2) {
                    notes[1].value = note['note'];
                }
                if (note['year'] == 3) {
                    notes[2].value = note['note'];
                }
                if (note['year'] == 4) {
                    notes[3].value = note['note'];
                }
            }
        });
    }
    function getpapercontent() {
        _supabase.from('_tblStrixhavenStar').select('*').then(response => {
            for (var x = 0; x < response.data.length; x++) {
                var story = response.data[x];
                var page = story['pageNo'];
                var location = story['location'];

                var title = story['title'];
                var content = story['content'];

                var id = "";
                if (location == "left") {
                    id = 'pg2left';
                }
                if (location == "middle top") {
                    id = 'pg2Mtop';
                }
                if (location == "middle bottom") {
                    id = 'pg2Mbot';
                }
                if (location == "right") {
                    id = 'pg2right';
                }

                const newTitle = document.createElement("input");
                newTitle.value = title;
                newTitle.disabled = "true";

                const newContent = document.createElement("textarea");
                newContent.value = content;
                newContent.readOnly = "true";

                // Get correct page
                var togoPage = document.getElementById('page' + page);

                if (page == 1) {
                    togoPage.querySelector('.Mainheadline').appendChild(newTitle);
                    togoPage.querySelector('#' + location).appendChild(newContent);

                    // check if sec con is out of view.
                    var contentContainer = togoPage.querySelector('.secContainer');
                    var bounding = contentContainer.getBoundingClientRect();
                    if (bounding.bottom > (window.innerHeight || document.documentElement.clientHeight)) {
                        //get height of title
                        var headerH = togoPage.querySelector('.Mainheadline').offsetHeight;
                        var currentH = contentContainer.offsetHeight;
                        contentContainer.style.height = currentH - headerH;
                    }
                } else {
                    if (id) {
                        var col = togoPage.querySelector('#' + id);

                        newTitle.classList = "colTitle";

                        // Append Title to Col
                        col.appendChild(newTitle);
                        // Append Content to Col
                        col.appendChild(newContent);
                    } else {
                        console.log(story);
                    }
                }
            }
        })
        _supabase.from('_tblJobs').select('*').order('id', 'ascending: true').then(response => {
            for (var x = 0; x < response.data.length; x++) {
                var job = response.data[x];
                var jloc = job["Location"];
                var jpay = job["Pay"];
                var jtit = job["Title"];
                var jid = job["id"];
                const newjob = document.createElement("div");
                const newtitle = document.createElement("input");
                const newdetails = document.createElement("div");
                const newlocation = document.createElement("input");
                const newpay = document.createElement("input");

                newtitle.value = jtit;
                newlocation.value = jloc;
                newpay.value = jpay;

                newtitle.disabled = "true";
                newlocation.disabled = "true";
                newpay.disabled = "true";

                newtitle.classList = "jtitle";
                newlocation.id = "jlocation";
                newpay.id = "jwage";

                newdetails.classList = "details";

                newdetails.appendChild(newlocation);
                newdetails.appendChild(newpay);

                newjob.appendChild(newtitle);
                newjob.appendChild(newdetails);

                newjob.classList = "job";
                newjob.id = jid;

                var page = document.querySelector(".pg3");
                page.querySelector('#joblisting').appendChild(newjob);
            }
        })
    }

    // Setters
    function saveExamScores(exams, results) {
        var sid = document.getElementById("players").querySelector('#profile').querySelector('#pid').value;
        for (var x = 0; x < exams.length; x++) {
            _supabase.from('exam<>student').update({ 'score': results[x] }).eq('exam', exams[x]).eq('student', sid).then(response => {
                // window.location = window.location;
            })
        }
    }
    function saveRelationship(cube) {
        var sid = document.getElementById("profile").querySelector('#pid').value;
        var nid = cube.id
        var score = cube.querySelector('input').value;

        var updateobject = {};
        updateobject['relationship'] = score;

        _supabase.from('npc<>student').update(updateobject).eq('student', sid).eq('npc', nid).then(response => {
            // window.location = location.pathname;
        })
    }
    function saveStudentData(inputs) {
        var updateobject = {};
        var sid = "";
        for (var x = 0; x < inputs.length; x++) {
            if (inputs[x].id == "nid" || inputs[x].id == "sid") {
                sid = inputs[x].value;
            } else {
                if (inputs[x].id != "npcList2") {
                    updateobject[inputs[x].id] = inputs[x].value;
                }
            }
        }
        _supabase.from('_tblStudents').update(updateobject).eq('id', sid).then(response => {
            // window.location = location.pathname;
        })
    }
    function saveTeacherData(inputs) {
        var updateobject = {};
        var tid = "";
        for (var x = 0; x < inputs.length; x++) {
            if (inputs[x].id == "tid") {
                tid = inputs[x].value;
            } else 
                if (inputs[x].id == "schooldropdown") {
                    inputs[x].id = "teacher_school";
                    updateobject[inputs[x].id] = inputs[x].value;
            } else 
            if (inputs[x].id == "teacherList") {

            } else {
                updateobject[inputs[x].id] = inputs[x].value;
            }
        }
        _supabase.from('_tblTeachers').update(updateobject).eq('id', tid).then(response => {
            // window.location = window.location;
        })
    }
    function saveNotes(inputs) {
        var updateobject = {};
        var noteid = "";
        for (var x = 0; x < inputs.length; x++) {
            noteid = x + 1;
            updateobject[inputs[x].id] = inputs[x].value;
            _supabase.from('notes').update(updateobject).eq('id', noteid).then(response => {

            })
        }
    }
    function saveSS(locations, headers, contents) {
        var updateobject = {};
        var id = "";
        for (var x = 0; x < headers.length; x++) {
            if (locations[x] == '#page1') {
                id = 1;
            }
            if (locations[x] == '#pg2left') {
                id = 2;
            }
            if (locations[x] == '#pg2Mtop') {
                id = 3;
            }
            if (locations[x] == '#pg2Mbot') {
                id = 4;
            }
            if (locations[x] == '#pg2right') {
                id = 5;
            }
            updateobject['title'] = headers[x].value;
            updateobject['content'] = contents[x].value;
            _supabase.from('_tblStrixhavenStar').update(updateobject).eq('id', id).then(response => {

            })
        }
    }
    function saveJobs(jobs) {
        var updateobject = {};
        var id = "";
        for (var x = 0; x < jobs.length; x++) {
            var job = jobs[x];
            id = job.id;

            updateobject['Title'] = job.querySelector('.jtitle').value;
            updateobject['Location'] = job.querySelector('#jlocation').value; 
            updateobject['Pay'] = job.querySelector('#jwage').value;

            _supabase.from('_tblJobs').update(updateobject).eq('id', id).then(response => {

            })
        }
    }
    
    // Creators
    function createAllRelationships() {
        alert('fuck this fucking fuckety fuck! FUCK!');
    }
    function createNewStudentData(inputs) {
        var updateobject = {};
        for (var x = 0; x < inputs.length; x++) {
            if (inputs[x].id == "nid" || inputs[x].id == "sid") {

            } else {
                updateobject[inputs[x].id] = inputs[x].value;
            }
        }
        _supabase.from('_tblStudents').insert(updateobject).then(response => {
            // window.location = window.location;
        })
    }

    // Removers
    function fireFromJob() {
        var sid = document.getElementById('profile').querySelector('#profileform1').querySelector('#pid').value;
        _supabase.from('Job<>Student').delete().eq('Student', sid).then(response => {
        })
        var parent = this.parentNode;
        parent.style.display = "none";
    }
    function kickFromClub() {
        var sid = document.getElementById('profile').querySelector('#profileform1').querySelector('#pid').value;
        var cid = this.id;
        _supabase.from('Club<>Student').delete().eq('club', cid).eq('student', sid).then(response => {
            var parent = this.parentNode;
            parent.style.display = "none";
        })
    }
    function deleteStudent(nid) {
        alert("Please send me a message saying 'I have tried to delete student " + nid + " can you see if it worked'");

        
        _supabase.from('npc<>student').select('*').eq({ id: nid }).then(response => {
            for (var x = 0; x < response.data.length; x++) {
                _supabase.from('npc<>student').delete().match({ npc: nid }).then(response => {
                })
                _supabase.from('Job<>Student').delete().match({ Student: nid }).then(response => {
                })
                _supabase.from('Club<>Student').delete().match({ student: nid }).then(response => {
                })
            }
            _supabase.from('_tblStudents').delete().match({ id: nid }).then(response => {
            })
        })
    }
</script>