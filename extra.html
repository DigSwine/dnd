<!Document>
<head>
    <link rel="stylesheet" type="text/css" href="/styles/imports.css">
    <link rel="stylesheet" type="text/css" href="/views/layout.css">
    <link rel="stylesheet" type="text/css" href="/views/nav.css">

    <link rel="stylesheet" type="text/css" href="/views/activites/style.css">

    <title>Strixhaven - Extracarriculars</title>
    <link rel="icon" href="/assets/strix_logo.png">

    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<html>
<body>
    <!-- Header -->
    <div data-include="header"></div>

    <!-- Navigation -->
    <div data-include="navigation"></div>

    <main>
        <div class="cubeWrapper">
            <div id="cubes">

            </div>
        </div>
    </main>
</body>
</html>

<script src="https://code.jquery.com/jquery-3.6.1.js"></script>
<script src="/javascript/nav.js"></script>
<script>
    var pageid = 'Extracurriculars';
    $(function () {
        var includes = $('[data-include]')
        $.each(includes, function () {
            var file = 'views/addons/_' + $(this).data('include') + '.html'
            $(this).load(file)
        })
        getClubs();
    })
</script>
<script src="https://unpkg.com/@supabase/supabase-js"></script>
<script src="/API/api.js"></script>
<script src="../../API/login.js"></script>
<script>
    function getClubs() {
        _supabase.from('Clubs').select('*').order('id', { ascending: true }).then(response => {
            var alldata = response.data;
            var clubs = [];
            _supabase.from('Club<>Student').select('club').eq('student', sessionStorage.getItem('Student_Id')).then(response => {
                if (sessionStorage.getItem('Student_Id')) {
                    for (var x = 0; x < response.data.length; x++) {
                        clubs.push(response.data[x]['club']);
                    }
                }
                for (var x = 0; x < alldata.length; x++) {
                    var data = alldata[x];
                    var page = document.getElementById('cubes');
                    const newCube = document.createElement("div");
                    const newContent = document.createElement("div");
                    const newQuote = document.createElement("q");
                    const newText = document.createElement("p");
                    const newHeartCont = document.createElement("div");
                    const newheart = document.createElement("i");

                    newheart.classList = "fa fa-heart-o";
                    newheart.ariaHidden = "false";
                    if (sessionStorage.getItem('Student_Id')) {
                        for (var y = 0; y < clubs.length; y++) {
                            if (clubs[y] == data['id']) {
                                newheart.classList = "fa fa-heart";
                                newheart.style.color = "darkgoldenrod";
                            }
                        }
                        newHeartCont.appendChild(newheart);
                        newHeartCont.classList = "heartcont";
                        newHeartCont.id = "col:" + data['id'];
                        newHeartCont.addEventListener('click', signup, false);
                    }
                    newText.innerText = data['desc'];
                    newQuote.innerText = data['quote'];
                    newContent.classList = "content";
                    newCube.classList = "cube";
                    newCube.style.backgroundImage = "url('../../assets/clubs/" + data['img'] + "')";
                    newContent.appendChild(newQuote);
                    newContent.appendChild(newText);
                    newContent.appendChild(newHeartCont);
                    newCube.appendChild(newContent);
                    page.appendChild(newCube);
                }
            })
        })
    }
    function signup() {
        var split = this.id.split(':');
        if (split) {
            var cid = split[1];
            var sid = sessionStorage.getItem('Student_Id');

            /* check number of signed up for clubs */
            _supabase.from('Club<>Student').select('*').eq('student', sid).then(response => {
                if (response.data.length < 3) {
                    // Check if club is already subscribed to
                    var prev = "no";
                    for (var x = 0; x < response.data.length; x++) {
                        if (cid == response.data[x].club) {
                            prev = "yes";
                        }
                    }
                    if (prev == "no") {
                        _supabase.from('Club<>Student').insert({ 'club': cid, 'student': sid }).then(response => {
                            alert("You have signed up");
                            var heart = $(this).find('i');
                            heart = heart[0];
                            heart.classList = "fa fa-heart";
                            heart.style.color = "darkgoldenrod";
                        })
                    } else {
                        alert("You are already a member of the club");
                    }
                    


                } else {
                    alert("you can only sign up to 3 at maximum");
                }
            })
        }        
    }
</script>