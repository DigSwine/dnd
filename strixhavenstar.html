<!Document>
<head>
    <link rel="stylesheet" type="text/css" href="/styles/imports.css">
    <link rel="stylesheet" type="text/css" href="/views/layout.css">
    <link rel="stylesheet" type="text/css" href="/views/nav.css">

    <link rel="stylesheet" type="text/css" href="/views/news/style.css">

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Strixhaven - Strixhaven Star </title>
    <link rel="icon" href="/assets/strix_logo.png">
</head>
<html>
<body>
    <!-- Header -->
    <div data-include="header"></div>

    <!-- Navigation -->
    <div data-include="navigation"></div>

    <!-- main -->
    <main>
        <div class="topcontainer">
            <div class="issue">2098423</div>
            <div class="slogan">the only paper around</div>
            <div class="paperdate">Monday, 1st November, 2022</div>
        </div>
        <div class="bodycontainer">
            <div id="leftc" class="LCorn hide" onclick="previouspg()"></div>
            <div id="rightc" class="RCorn show" onclick="nextpg()"></div>

            <div id="page1" class="pg1 show">page 1</div>
            <div id="page2" class="pg2 hide">page 2</div>
            <div id="page3" class="pg3 hide">page 3</div>
        </div>
    </main>
</body>
</html>

<script src="https://code.jquery.com/jquery-3.6.1.js"></script>
<script src="https://unpkg.com/@supabase/supabase-js"></script>
<script src="/javascript/nav.js"></script>
<script src="/javascript/paper.js"></script>
<script src="/API/api.js"></script>
<script>
    var pageid = 'Strixhaven Star';
    $(function () {
        var includes = $('[data-include]')
        $.each(includes, function () {
            var file = 'views/addons/_' + $(this).data('include') + '.html'
            $(this).load(file);
        })
        getpapercontent();
    })

    // Strixhaven Star
    function getpapercontent() {
        const { createClient } = supabase;

        var anon = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBkY2Nhem1uemlwcGJsbnZ2cWRwIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTY2NzczNDkyOCwiZXhwIjoxOTgzMzEwOTI4fQ.79swd9Gvw45ziqMzXrIxPSnQU67K6swiVnSJAzujLqA';
        var url = 'https://pdccazmnzippblnvvqdp.supabase.co';
        const _supabase = createClient(url, anon);

        _supabase.from('_tblStrixhavenStar').select('*').then(response => {
            unpackdata(response.data);
        })
    }

    function unpackdata(data) {
        for (var x = 0; x < data.length; x++) {
            var story = data[x];
            var page = story['pageNo'];
            var location = story['location'];

            var title = story['title'];
            var content = story['content'];

            // Get correct page
            var togoPage = document.getElementById('page' + page);

            if (page == 1) {
                togoPage.querySelector('.Mainheadline').innerText = title;
                togoPage.querySelector('#' + location).innerText = content;

                // check if sec con is out of view.
                var contentContainer = togoPage.querySelector('.secContainer');
                var bounding = contentContainer.getBoundingClientRect();
                if (bounding.bottom > (window.innerHeight || document.documentElement.clientHeight)) {
                    //get height of title
                    var headerH = togoPage.querySelector('.Mainheadline').offsetHeight;
                    var currentH = contentContainer.offsetHeight;
                    contentContainer.style.height = currentH - headerH;
                }
            } else {
                var id = "";
                if (location == "left") {
                    id = 'pg2left';
                }
                if (location == "middle top") {
                    id = 'pg2Mtop';
                }
                if (location == "middle bottom") {
                    id = 'pg2Mbot';
                }
                if (location == "right") {
                    id = 'pg2right';
                }
                if (id) {
                    var col = togoPage.querySelector('#' + id);

                    // Create Title and Content
                    const newTitle = document.createElement("h2");
                    const newContent = document.createElement("p");

                    newTitle.innerText = title;
                    newContent.innerText = content;

                    // Append Title to Col
                    col.appendChild(newTitle);
                    // Append Content to Col
                    col.appendChild(newContent);

                    
                } else {
                    console.log(story);
                }
            }
        }
    }
        
    










    var showing = 0;
    var pages = ["page1", "page2", "page3"];
    function toggleshow(el) {
        var element = document.getElementById(el);
        var tCL = element.classList;
        if (tCL.contains("show")) {
            var newCL = tCL.replace("show", "hide");
            console.log("newCL = " + newCL);
        }           
        document.getElementById(el).classList = tCL;
    }


    function nextpg() {
        if (showing < 2) {
            for (var x = 0; x < pages.length; x++) {
                toggleshow(pages[x]);
            }
            showing++;

            var toshow = document.getElementById(pages[showing]);
            var tCL = toshow.classList;
            if (tCL.contains("hide")) {
                var newCL = tCL.replace("hide", "show");
                console.log("newCL = " + newCL);
            }       
            document.getElementById(pages[showing]).classList = tCL + " show";
            document.getElementById("leftc").classList = "LCorn show";
            if (showing == 2) {
                document.getElementById("rightc").classList = "RCorn hide";
            }
        }
    }

    function previouspg() {
        if (showing > 0) {
            for (var x = 0; x < pages.length; x++) {
                toggleshow(pages[x]);
            }
            showing--;
            var toshow = document.getElementById(pages[showing]);
            var tCL = toshow.classList;
            if (tCL.contains("hide")) {
                var newCL = tCL.replace("hide", "show");
                console.log("newCL = " + newCL);
            }
            document.getElementById(pages[showing]).classList = tCL + " show";
            document.getElementById("rightc").classList = "RCorn show";
            if (showing == 0) {
                document.getElementById("leftc").classList = "LCorn hide";
            }
        }
    }

    var ids = [".pg1", ".pg2", ".pg3"];
    var urls = ["views/news/_page1.html", "views/news/_page2.html", "views/news/_page3.html"];
    $.get(urls[0], function (data) {
        $(ids[0]).html(data);
        console.log("page 1 has been loaded");
    });
    $.get(urls[1], function (data) {
        $(ids[1]).html(data);
        console.log("page 2 has been loaded");
    });
    $.get(urls[2], function (data) {
        $(ids[2]).html(data);
        console.log("page 3 has been loaded");
    });

</script>