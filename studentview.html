<!Document>
<head>
    <link rel="stylesheet" type="text/css" href="/styles/imports.css">
    <link rel="stylesheet" type="text/css" href="/views/layout.css">
    <link rel="stylesheet" type="text/css" href="/views/nav.css">

    <link rel="stylesheet" type="text/css" href="/views/studentView/studentView.css">

    <title>Student</title>
    <link rel="icon" href="/assets/strix_logo.png">

</head>
<html>
<body>
    <!-- Header -->
    <div data-include="header"></div>

    <!-- Navigation -->
    <div data-include="navigation"></div>

    <!-- BG -->
    <div id="bg1"></div>
    <div id="particleGenerator"></div>

    <!-- Main -->
    <main>
        <div class="container">
            <div class="left">
                <div class="personcontainer">
                    <div class="info" id="info">
                        <div class="lefttopcontainer">
                            <div class="card">
                                <img id="profilepicture" />
                            </div>
                            <form id="profileform" class="profile">
                                <label>Name: <input id="name" placeholder="Name" disabled /></label>
                                <label>Age: <input id="age" placeholder="Age" disabled /></label>
                                <label>Gender: <input id="gender" placeholder="Gender" disabled /></label>
                                <label>Race: <input id="race" placeholder="Race" disabled /></label>
                                <label>Alignment: <input id="alignment" placeholder="Alignment" disabled /></label>
                                <label>Hair Colour: <input id="haircolour" placeholder="Hair Colour" disabled /></label>
                                <label>Eye Colour: <input id="eyecolour" placeholder="Eye Colour" disabled /></label>
                                <label>Height: <input id="height" placeholder="Height" disabled /></label>
                                <label>Weight: <input id="weight" placeholder="Weight" disabled /></label>
                                <div class="subControls">
                                    <div class="subControl" id="edit"><p>Edit</p></div>
                                    <div class="subControl" id="save"><p>Save</p></div>
                                </div>
                            </form>
                        </div>
                        <div class="personality scrollbar">
                            <div class="personal">
                                <p>Personality Traits:</p>
                                <textarea id="personalitytraits" placeholder="Personality Traits" readonly></textarea>
                            </div>
                            <div class="personal">
                                <p>Ideals:</p>
                                <textarea id="ideals" placeholder="Ideals" readonly></textarea>
                            </div>
                            <div class="personal">
                                <p>Bonds:</p>
                                <textarea id="bonds" placeholder="Bonds" readonly></textarea>
                            </div>
                            <div class="personal">
                                <p>Flaws:</p>
                                <textarea id="flaws" placeholder="Flaws" readonly></textarea>
                            </div>
                            <div class="personal">
                                <p>Goals:</p>
                                <textarea id="goals" placeholder="Your life time desire" readonly></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="story" id="story">
                        <div class="backstory">
                            <h1>Backstory</h1>
                            <textarea id="backstory" class="scrollbar" placeholder="Backstory" readonly></textarea>
                        </div>
                        <div class="extrainfo">
                            <h1>Extra Notes</h1>
                            <textarea id="extrainfo" class="scrollbar" placeholder="Info about you" readonly></textarea>
                        </div>
                    </div>
                </div>
                <div class="controls">
                    <div class="control" id="profile"><p>Profile</p></div>
                    <div class="control" id="details"><p>Details</p></div>
                </div>
            </div>

            <div class="right">
                <div class="controls">
                    <div class="control" id="one"><p>Course Listings</p></div>
                    <div class="control" id="two"><p>Exam Report Card</p></div>
                    <div class="control" id="three"><p>Relationships</p></div>
                    <div class="control" id="four"><p>Job and Extracurriculas</p></div>
                </div>
                <div class="mainslider" id="mainslider">
                    <div class="slide" id="S1">
                        <h1 class="slideTitle"> Courses </h1>
                        <div class="subnav">
                            <div id="one" class="sub">First Years</div>
                            <div id="two" class="sub">Second Years</div>
                            <div id="three" class="sub">Thrid Years</div>
                            <div id="four" class="sub">Fourth Years</div>
                        </div>
                        <div id="yrCLASSESone" class="yr one">
                            <h2>Enrolled in</h2>
                            <table id="enrolledCLASSES">
                                <tr>
                                    <th>Class Title</th>
                                    <th>Teacher Name</th>
                                    <th>Teacher Image</th>
                                </tr>
                                <tr>
                                    <td>Class 1</td>
                                    <td>Jeff Dunham</td>
                                    <td><img src="" /></td>
                                </tr>
                            </table>

                        </div>
                        <div id="yrCLASSEStwo" class="yr two" hidden>

                        </div>
                        <div id="yrCLASSESthree" class="yr three" hidden>

                        </div>
                        <div id="yrCLASSESfour" class="yr four" hidden>

                        </div>
                    </div>
                    <div class="slide">
                        <h1 class="slideTitle"> Page 2 </h1>
                    </div>
                    <div class="slide" style="background-color: antiquewhite">
                        <h1 class="slideTitle"> Relationships </h1>
                        <div class="relation">
                            <img src="" />
                            <p class="name">Eliza</p>
                            <p class="name">Archenemy</p>
                        </div>
                    </div>
                    <div class="slide">
                        <div class="jobs" id="currentJob">
                            <h1>Job</h1>
                        </div>
                        <div class="activities" id="activities">
                            <h1>Extracurriculas</h1>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
</body>
</html>

<script src="https://code.jquery.com/jquery-3.6.1.js"></script>
<script src="/javascript/nav.js"></script>
<script src="https://unpkg.com/@supabase/supabase-js"></script>
<script>
    var pageid = 'Loading';
    $(function () {
        var includes = $('[data-include]')
        $.each(includes, function () {
            var file = 'views/addons/_' + $(this).data('include') + '.html'
            $(this).load(file)
        }) 
    })

    $(' .subControls .subControl').click(function () {
        var inputs = ['name', 'age', 'gender', 'race', 'alignment', 'haircolour', 'eyecolour', 'height', 'weight', 'personalitytraits', 'ideals', 'bonds', 'flaws', 'backstory', 'extrainfo', 'goals'];
        if (this.id == "edit") {
            for (var x = 0; x < inputs.length; x++) {
                var elem = document.getElementById(inputs[x]);
                
                if (elem.tagName.toLowerCase() == "textarea") {
                    elem.toggleAttribute("readonly", false);
                } else {
                    elem.toggleAttribute("disabled", false);
                }
            }
        }
        if (this.id == "save") {
            for (var x = 0; x < inputs.length; x++) {
                var elem = document.getElementById(inputs[x]);
                elem.toggleAttribute("disabled", false);
            }
            saveStudentData(inputs);            
        }
    });
    $('.left .control').click(function () {
        if (this.id == "details") {
            document.getElementById("info").style.opacity = 0;
            setTimeout(() => {
                document.getElementById("info").style.display = "none";
                document.getElementById("story").style.display = "block";
                document.getElementById("story").style.opacity = 1;
            }, 500);
        } else {
            document.getElementById("story").style.opacity = 0;
            setTimeout(() => {
                document.getElementById("story").style.display = "none";
                document.getElementById("info").style.display = "block";
                document.getElementById("info").style.opacity = 1;
            }, 500);
        }
    });
    $('.sub').click(function () {
        document.getElementById('yrCLASSESone').setAttribute('hidden', true);
        document.getElementById('yrCLASSEStwo').setAttribute('hidden', true);
        document.getElementById('yrCLASSESthree').setAttribute('hidden', true);
        document.getElementById('yrCLASSESfour').setAttribute('hidden', true);
        document.getElementById('yrCLASSES' + this.id).removeAttribute('hidden');
    })

    var showing = 0;
    $('.right .control').click(function () {
        var MS = document.getElementById('mainslider');
        showing = toshow(this.id);
        var distance = "-" + $("#S1").width() * showing + "px";
        MS.style.transform = "translateX(" + distance + ")";
    });
    function toshow(id) {
        var send = 0;
        if (id == "one") {
            send = 0;
        }
        if (id == "two") {
            send = 1;
        }
        if (id == "three") {
            send = 2;
        }
        if (id == "four") {
            send = 3;
        }
        return send;
    }
</script>
<script src="../../API/api.js"></script>
<script src="/javascript/login.js"></script>
<script>
    $(document).ready(function () {
        var data = JSON.parse(sessionStorage.getItem("Student_Id"));
        if (data) {
            getStudentDataByID(data);
        }
    })

    function getStudentDataByID(sid) {
        /* Student Data */
        _supabase.from('_tblStudents').select('*').eq('id', sid).order('id', { ascending: true }).then(response => {
            for (var x = 0; x < response.data.length; x++) {
                var student = response.data[x];
                var alignment = student['Alignment'];
                var eyes = student['Eye Colour'];
                var hair = student['Hair Colour'];
                var height = student['Height'];
                var img = student['Profile Picture'];
                var weight = student['Weight'];
                var age = student['character_age'];
                var gender = student['character_gender'];
                var name = student['character_name'];
                var race = student['character_race'];
                var personal = student['Personality'];
                var ideal = student['Ideals'];
                var bond = student['Bonds'];
                var flaw = student['Flaws'];
                var story = student['Backstory'];
                var notes = student['Notes'];
                var goal = student['Goals'];

                var info = document.getElementById('info');
                info.querySelector('#profilepicture').src = "assets/students/players/" + img;
                info.querySelector('#name').value = name;
                info.querySelector('#age').value = age;
                info.querySelector('#gender').value = gender;
                info.querySelector('#race').value = race;
                info.querySelector('#alignment').value = alignment;
                info.querySelector('#haircolour').value = hair;
                info.querySelector('#eyecolour').value = eyes;
                info.querySelector('#height').value = height;
                info.querySelector('#weight').value = weight;

                info.querySelector('#personalitytraits').value = personal;
                info.querySelector('#ideals').value = ideal;
                info.querySelector('#bonds').value = bond;
                info.querySelector('#flaws').value = flaw;
                info.querySelector('#goals').value = goal;

                info.querySelector('#personalitytraits').style.height = info.querySelector('#personalitytraits').scrollHeight + 'px';
                info.querySelector('#ideals').style.height = info.querySelector('#ideals').scrollHeight + 'px';
                info.querySelector('#bonds').style.height = info.querySelector('#bonds').scrollHeight + 'px';
                info.querySelector('#flaws').style.height = info.querySelector('#flaws').scrollHeight + 'px';
                info.querySelector('#goals').style.height = info.querySelector('#goals').scrollHeight + 'px';

                var storyloc = document.getElementById('story');
                storyloc.querySelector('#backstory').value = story;
                storyloc.querySelector('#extrainfo').value = notes;

                if (name) {
                    var headertitle = document.getElementById('pagename');
                    if (headertitle) {
                        headertitle.innerText = "Welcome " + name;
                    } else {
                        setTimeout(function () {
                            headertitle = document.getElementById('pagename');
                            headertitle.innerText = "Welcome " + name;
                        }, 5000);
                    }
                }
            }
        })
        _supabase.from('Job<>Student').select('Job (id, Title, Location, Pay)').eq('Student', sid).then(response => {
                if (response.data.length > 0) {
                    for (var x = 0; x < response.data.length; x++) {
                        var data = response.data[x];
                        var job = data['Job'];

                        var currentJob = document.getElementById('currentJob');

                        const theJob = document.createElement('div');
                        const theJobDetails = document.createElement('div');
                        const theTitle = document.createElement('h3');
                        const theLocation = document.createElement('p');
                        const theWage = document.createElement('p');
                        const theCoworker = document.createElement('p');
                        const QuitButton = document.createElement('button');

                        theJob.classList = "myjob";
                        theJob.id = "myjob";
                        QuitButton.classList = "quit";
                        QuitButton.id = job['id'];
                        QuitButton.innerText = "Resign";
                        QuitButton.addEventListener('click', quitJob, false);

                        theTitle.innerText = job['Title'];

                        theJobDetails.classList = "jobdetails";

                        theLocation.innerText = job['Location'];
                        theLocation.classList = "location";

                        theWage.innerText = job['Pay'];
                        theWage.classList = "wage";

                        _supabase.from('Job<>Student').select('Student (id, character_name, character_player)').eq('Job', job['id']).then(response => {
                            var allworkers = response.data;
                            for (var y = 0; y < allworkers.length; y++) {
                                var worker = allworkers[y]['Student'];
                                if (!worker['character_player']) {
                                    theCoworker.innerText = worker['character_name'];
                                }
                            }
                            theCoworker.classList = "coworker";

                            theJobDetails.appendChild(theTitle);
                            theJobDetails.appendChild(theLocation);
                            theJobDetails.appendChild(theWage);
                            theJobDetails.appendChild(theCoworker);
                            theJobDetails.appendChild(QuitButton);

                            theJob.appendChild(theJobDetails);
                            currentJob.appendChild(theJob);
                        })
                }
            }
        })
        _supabase.from('Club<>Student').select('club (id, name)').eq('student', sid).then(response => {
            if (response.data.length > 0) {
                var activites = document.getElementById('activities');
                for (var x = 0; x < response.data.length; x++) {
                    var data = response.data[x];
                    var club = data['club'];

                    var clubid = club['id'];
                    var clubname = club['name'];

                    const theClub = document.createElement('div');
                    const theClubName = document.createElement('h3');
                    const leaveBtn = document.createElement('button');

                    theClub.classList = "club";

                    theClubName.innerText = clubname;
                    theClubName.classList = "clubname";

                    leaveBtn.innerText = "Leave Club";
                    leaveBtn.id = clubid;

                    theClub.appendChild(theClubName);
                    theClub.appendChild(leaveBtn);

                    activites.appendChild(theClub);
                }
            }
        })
    }
    function saveStudentData(inputs) {
        /* Eliza Belmont */
        var data = [];
        for (var x = 0; x < inputs.length; x++) {
            var value = document.getElementById(inputs[x]).value;
            if (value) {
                data.push(value);
            } else {
                data.push("");
            }            
        }

        _supabase.from('_tblStudents').update({ 'character_name': data[0], 'character_age': data[1], 'character_gender': data[2], 'character_race': data[3], 'Alignment': data[4], 'Hair Colour': data[5], 'Eye Colour': data[6], 'Height': data[7], 'Weight': data[8], 'Personality': data[9], 'Ideals': data[10], 'Bonds': data[11], 'Flaws': data[12], 'Backstory': data[13], 'Notes': data[14], 'Goals': data[15] }).eq('id', sessionStorage.getItem("Student_Id")).then(response => {
            var currentpage = location.pathname;
            window.location = currentpage;
        })
    }
    function quitJob() {
        var sid = JSON.parse(sessionStorage.getItem("Student_Id"));
        var jid = this.id;
        _supabase.from('Job<>Student').delete().eq('Student', sid).then(response => {
        })
        _supabase.from('_tblJobs').update({ 'Player Filled': 'No' }).eq('id', jid).then(response => {
        })
        alert("You have now resigned");
        document.getElementById('myjob').style.display = "none";
    }

var x;
var $cards = $(".card");
var $style = $(".hover");

$cards
  .on("mousemove touchmove", function(e) { 
    // normalise touch/mouse
    e.preventDefault();
    var $card = $(this);
    var h = $card.height();
    var w = $card.width();
    var px = Math.abs(Math.floor(100 / w * 0)-100);
    var py = Math.abs(Math.floor(100 / h * 0)-100);
    var pa = (50-px)+(50-py);
    // set / apply css class and style
    $cards.removeClass("active");
    $card.removeClass("animated");
    if ( e.type === "touchmove" ) {
      return false; 
    }
    clearTimeout(x);
  }).on("mouseout touchend touchcancel", function() {
    // remove css, apply custom animation on end
    var $card = $(this);
    $style.html("");
    x = setTimeout(function() {
      $card.addClass("animated");
    },1000);
  });
</script>